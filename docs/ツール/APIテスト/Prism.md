# Prism

## 概要

Prism は OpenAPI を入力としてモックサーバーとリクエスト検証を提供するツールである。仕様駆動開発（Design First / Contract First）に向いており、API 実装前から契約に沿った疎通確認やテストを進められる。軽量な CLI 中心でローカル開発に導入しやすい。

## 料金

| プラン | 内容 |
|------|------|
| OSS 版 | 無料（MIT License） |
| 商用利用 | ライセンス上可能（組織ポリシー確認は必要） |

## 主な特徴

| 項目 | 内容 |
|------|------|
| OpenAPI 特化 | 仕様ファイルを直接利用してモック・検証 |
| 軽量 CLI | 依存が少なく導入しやすい |
| 契約検証 | リクエスト/レスポンスを仕様に照合 |
| 早期並行開発 | 実装前にフロントエンド開発を開始可能 |
| 自動化向き | 仕様準拠チェックを組み込みやすい |

## 主な機能

### モック機能

| 機能 | 説明 |
|------|------|
| OpenAPI モック | 仕様からエンドポイントを自動生成 |
| サンプル利用 | examples を優先したレスポンス生成 |
| 動的レスポンス | パラメータに応じた返却に対応 |
| ローカル起動 | 単一コマンドでモックサーバーを起動 |

### 検証機能

| 機能 | 説明 |
|------|------|
| 入力検証 | パス、クエリ、ヘッダー、Body を検証 |
| 出力検証 | ステータスコードとレスポンススキーマを検証 |
| 契約逸脱検知 | 仕様にない応答を可視化 |
| API 品質向上 | 実装前後で契約準拠を維持 |

### 運用機能

| 機能 | 説明 |
|------|------|
| CLI 実行 | ローカルで共通運用 |
| Docker 実行 | コンテナ化してチーム共有 |
| ログ出力 | 仕様不一致を調査しやすい |
| 開発支援 | API 設計レビュー時の即時検証 |

## インストールとセットアップ

公式URL:
- [Prism 公式（GitHub）](https://github.com/stoplightio/prism)
- [Stoplight Docs](https://docs.stoplight.io/docs/prism)

セットアップの要点:
1. `@stoplight/prism-cli` をインストールする。
2. OpenAPI ファイルをリポジトリで管理する。
3. モック起動と検証プロキシの使い分け方針を決める。

## 基本的な使い方

1. OpenAPI の `paths` と `responses` を先に定義する。
2. Prism をモックモードで起動し、クライアント側疎通を確認する。
3. 実 API ができたらプロキシモードで契約準拠を検証する。
4. 仕様差分が出たら OpenAPI と実装のどちらを修正するか即時判断する。

最小コマンド:
- モック起動: `prism mock ./openapi.yaml`
- 検証プロキシ: `prism proxy ./openapi.yaml https://api.example.com`

## メリット

- OpenAPI を単一ソースとして運用しやすい
- 実装前から疎通確認を開始できる
- 契約逸脱を早期に検知できる
- CLI ベースで自動実行へ接続しやすい

## デメリット

- OpenAPI 品質が低いと効果が出にくい
- ツール固有挙動の理解が必要
- 高度な状態遷移モックは別ツール併用が必要な場合がある

## Docker での使用

`stoplight/prism` イメージを使うと、ローカル環境差分を減らして起動できる。OpenAPI ファイルを read-only マウントし、ポート固定で運用するのが安全。

## 他ツールとの比較

| ツール | 主な対象 | 特徴 |
|------|------|------|
| Prism | OpenAPI 契約テスト | 仕様準拠チェックに強い |
| MockServer | 高機能モック/検証 | Proxy/Record と拡張性が高い |
| WireMock | HTTP モック全般 | 採用実績が豊富 |
| MSW | フロントエンド開発 | UI 開発向けに扱いやすい |

## ベストプラクティス

### 1. OpenAPI を最新版に保つ

- 実装変更時に仕様更新を必須化する
- 例データも同時更新してモック品質を担保する

### 2. 契約チェックを標準化

- 変更ごとに主要エンドポイントを検証する
- 契約違反をリリース前に必ず修正する

### 3. 仕様粒度を統一

- ステータスコードとエラーレスポンスを明示する
- 共通スキーマを再利用して重複を減らす

## 公式ドキュメント

- GitHub: https://github.com/stoplightio/prism
- ドキュメント: https://docs.stoplight.io/docs/prism
- npm: https://www.npmjs.com/package/@stoplight/prism-cli

## まとめ

- OpenAPI 仕様からモックと契約検証を実行でき、仕様駆動開発と相性が良い。
- 軽量に導入できるため、設計段階からAPI契約チェックを始めやすい。
- 仕様更新と契約チェックを継続することで、実装との差分を早期に発見できる。
