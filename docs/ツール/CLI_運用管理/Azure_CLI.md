# Azure CLI

## 概要

Azure CLI は Azure リソースをコマンドラインで操作する公式ツールである。スクリプト化しやすく、インフラ構築・運用自動化・日常オペレーションに広く利用される。

## 料金

| 区分 | 内容 |
|------|------|
| Azure CLI 本体 | 無料 |
| Azure 利用料 | 作成・利用する Azure リソースに対して課金 |

## 主な特徴

| 項目 | 内容 |
|------|------|
| 公式ツール | Azure API と親和性が高い |
| 自動化向き | シェル/CI で再利用しやすい |
| クロスプラットフォーム | Windows/macOS/Linux で利用可能 |
| 拡張性 | 拡張機能で機能追加が可能 |
| 学習しやすい | 一貫したコマンド体系 |

## 主な機能

### リソース操作

| 機能 | 説明 |
|------|------|
| 作成/更新/削除 | VM、Storage、Network などを管理 |
| 一覧/検索 | リソース状態を取得 |
| デプロイ | Bicep/ARM デプロイを実行 |
| 出力整形 | `json`、`table`、`tsv` などで表示 |

### 認証・権限

| 機能 | 説明 |
|------|------|
| サインイン | ユーザー/サービスプリンシパルで認証 |
| サブスクリプション切替 | 複数契約を切り替え運用 |
| RBAC 操作 | ロール割当の確認・設定 |
| テナント指定 | 組織境界を意識した運用が可能 |

### 運用支援

| 機能 | 説明 |
|------|------|
| クエリ | JMESPath で結果抽出 |
| 拡張機能 | `az extension` で追加機能導入 |
| スクリプト実行 | バッチ処理・定期処理へ組み込み |
| 非対話実行 | CI/CD や自動化ジョブで利用可能 |

## インストールとセットアップ

公式URL:
- [Azure CLI 公式](https://learn.microsoft.com/cli/azure/)
- [インストール手順](https://learn.microsoft.com/cli/azure/install-azure-cli)

セットアップ手順:
1. OS に応じた方法で Azure CLI をインストールする。
2. `az login` で認証し、利用サブスクリプションを設定する。
3. 初期設定として既定リージョン・出力形式を決める。

## 基本的な使い方

1. 認証後に対象サブスクリプションを選択する。
2. まず一覧系コマンドで現状把握してから変更系を実行する。
3. 変更系コマンドは本番前にテスト環境で検証する。
4. 定型操作はスクリプト化し、手作業差分を減らす。

最小コマンド:
- ログイン: `az login`
- サブスクリプション確認: `az account show`
- リソースグループ一覧: `az group list -o table`

## メリット

- Azure 操作を標準化しやすい
- スクリプト化で再現性を確保しやすい
- GUI より高速に大量処理しやすい
- IaC と組み合わせて運用しやすい

## デメリット

- コマンド習熟が必要
- 誤操作時の影響が大きいため権限制御が必須
- バージョン差異で挙動が変わる場合がある

## 他ツールとの比較

| ツール | 主な用途 | 特徴 |
|------|------|------|
| Azure CLI | Azure 運用/自動化 | 公式・軽量・スクリプト向き |
| Azure PowerShell | Azure 運用 | PowerShell 連携に強い |
| Azure Portal | 手動操作 | GUI で直感的に確認しやすい |
| Terraform | IaC | マルチクラウド管理に強い |

## ベストプラクティス

### 1. 認証を自動化向けに統一

- CI はサービスプリンシパルを利用する
- 人手運用と自動運用の権限を分離する

### 2. 出力とログを標準化

- `--output` をチームで統一する
- 変更実行ログを保存する

### 3. 安全な変更フローを作る

- 本番前に検証環境で実行する
- 重要操作はレビュー付きスクリプト化する

## 公式ドキュメント

- 公式: https://learn.microsoft.com/cli/azure/
- インストール: https://learn.microsoft.com/cli/azure/install-azure-cli
- コマンドリファレンス: https://learn.microsoft.com/cli/azure/reference-index

## まとめ

1. ** 標準化 ** : Azure CLI は Azure 運用の標準コマンド基盤として有効。
2. ** 再現性 ** : 手順をスクリプト化すると再現性と速度が向上する。
3. ** 安全性 ** : 権限管理と変更フローを設計して安全に運用することが重要。
