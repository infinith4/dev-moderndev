# Appium

## 概要

Appium は、iOS と Android のモバイルアプリを自動テストするためのオープンソースフレームワークである。WebDriver プロトコルをベースにしており、既存の Selenium 系資産や各種テストランナーと組み合わせて E2E テストを構築しやすい。

## 料金

| プラン | 内容 |
|------|------|
| OSS 版 | 無料（Apache License 2.0） |
| 商用利用 | ライセンス上可能（組織ポリシー確認は必要） |

## 主な特徴

| 項目 | 内容 |
|------|------|
| クロスプラットフォーム | iOS / Android を同じ思想でテスト可能 |
| 実機・エミュレーター対応 | 開発端末と CI 用端末の両方で実行できる |
| 言語選択 | Java、JavaScript、Python など主要言語に対応 |
| WebDriver 準拠 | Selenium の知見を流用しやすい |
| 拡張性 | ドライバ・プラグインで用途を拡張可能 |

## 主な機能

### テスト実行機能

| 機能 | 説明 |
|------|------|
| UI 操作 | タップ、入力、スクロール、スワイプなどを自動化 |
| 要素取得 | アクセシビリティ ID、XPath、Class などで特定 |
| アサーション | 画面状態やテキスト表示を検証 |
| 待機制御 | 要素表示待ちでフレークを低減 |

### デバイス連携機能

| 機能 | 説明 |
|------|------|
| 実機接続 | USB 接続端末で実動作を確認 |
| エミュレーター | Android Emulator / iOS Simulator を利用 |
| 複数端末運用 | 端末ごとの capability で設定切替 |
| ログ取得 | 端末ログで失敗原因を追跡 |

### 運用機能

| 機能 | 説明 |
|------|------|
| サーバー実行 | Appium サーバーをローカル/共有環境で起動 |
| セッション管理 | テスト単位で初期化と終了を制御 |
| スクリーンショット | 失敗時の証跡を取得 |
| レポート連携 | Allure など外部レポーターと接続 |

## インストールとセットアップ

公式URL:
- [Appium 公式サイト](https://appium.io/)
- [Appium Docs](https://appium.io/docs/en/latest/)
- [Appium GitHub](https://github.com/appium/appium)

セットアップの要点:
1. Node.js を準備し、Appium サーバーをインストールする。
2. iOS/Android それぞれの開発ツール（Xcode / Android SDK）を用意する。
3. テスト言語に合わせた Appium クライアントライブラリを追加する。

## 基本的な使い方

1. Appium サーバーを起動し、接続先ポートを固定する。
2. テスト対象アプリと端末情報を capability として定義する。
3. 主要画面の操作シナリオを作成し、まず正常系から自動化する。
4. 失敗時にスクリーンショットと端末ログを取得する設定を入れる。

最小コマンド:
- サーバー起動: `appium`

## メリット

- モバイル E2E テストを共通基盤で運用しやすい
- iOS/Android の差分を吸収しながらテストを統一できる
- 実機検証を自動化に組み込みやすい
- Selenium 系の知見を流用できる

## デメリット

- 初期セットアップ（SDK、署名、端末設定）の負荷が高い
- モバイル特有のフレーク対策が必要
- 実機台数が増えると運用コストが上がる

## 他ツールとの比較

| ツール | 主な対象 | 特徴 |
|------|------|------|
| Appium | モバイル E2E | iOS/Android 両対応の定番 |
| Espresso | Android UI テスト | Android ネイティブで高速 |
| XCUITest | iOS UI テスト | iOS ネイティブで安定 |
| Detox | React Native | JS ベースで RN との親和性が高い |

## ベストプラクティス

### 1. 要素特定ルールを統一

- 可能な限りアクセシビリティ ID を優先する
- XPath 依存を減らして保守性を上げる

### 2. テストデータを固定

- 事前データ投入と後片付けを自動化する
- 端末状態の差分で失敗しないよう初期化を徹底する

### 3. フレーク対策を標準化

- 明示的待機を使い、固定スリープを避ける
- 失敗時ログ・スクリーンショットを必ず保存する

## 公式ドキュメント

- 公式サイト: https://appium.io/
- ドキュメント: https://appium.io/docs/en/latest/
- GitHub: https://github.com/appium/appium

## まとめ

1. ** 統一基盤 ** : iOS と Android を同一方針で自動化でき、モバイル E2E 基盤を統一しやすい。
2. ** 継続検証 ** : 実機・エミュレータ運用を組み合わせることで、主要シナリオを継続的に検証できる。
3. ** 安定運用 ** : 要素特定と待機戦略を標準化すると、フレークを抑えた安定運用につなげやすい。
