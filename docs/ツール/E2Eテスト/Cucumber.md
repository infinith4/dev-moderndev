# Cucumber

## 概要

Cucumber は BDD（Behavior-Driven Development）向けのテストフレームワークである。`Given / When / Then` 形式で仕様を記述し、実装コードと結び付けて実行できるため、非エンジニアを含むチームで期待仕様を共有しやすい。

## 料金

| プラン | 内容 |
|------|------|
| OSS 版 | 無料（Open Source） |
| 商用利用 | ライセンス上可能（組織ポリシー確認は必要） |

## 主な特徴

| 項目 | 内容 |
|------|------|
| BDD 記法 | Gherkin で業務仕様を可読化 |
| 多言語対応 | Java、JavaScript、Ruby などで実装可能 |
| 仕様と実装の接続 | Step Definition でシナリオをコード化 |
| 共有しやすさ | PM・QA・開発で同じシナリオを参照可能 |
| 拡張性 | Selenium/Playwright 等と連携可能 |

## 主な機能

### シナリオ記述機能

| 機能 | 説明 |
|------|------|
| Feature ファイル | 機能単位でシナリオを管理 |
| Scenario Outline | パラメータ化したテストケースを展開 |
| Tag 管理 | 実行対象の絞り込みが可能 |
| 背景定義 | 共通前提を `Background` で再利用 |

### 実装連携機能

| 機能 | 説明 |
|------|------|
| Step Definition | 文言と実装コードをマッピング |
| Hooks | 前処理・後処理を一元化 |
| アサーション連携 | 任意のテストライブラリを利用可能 |
| レポート連携 | 実行結果を HTML/JSON で出力 |

### 運用機能

| 機能 | 説明 |
|------|------|
| シナリオ分類 | smoke/regression などタグで整理 |
| 再利用性 | 共通ステップ化で重複を削減 |
| テスト資産化 | 仕様ドキュメントとしても機能 |
| チーム連携 | 仕様レビューとテスト実行を接続 |

## インストールとセットアップ

公式URL:
- [Cucumber 公式](https://cucumber.io/)
- [Cucumber Docs](https://cucumber.io/docs/)
- [Cucumber GitHub](https://github.com/cucumber)

セットアップの要点:
1. 対象言語の Cucumber パッケージを追加する。
2. `features` と `step_definitions` のディレクトリ構成を決める。
3. テスト実行コマンドとタグ運用ルールを先に定義する。

## 基本的な使い方

1. まず業務観点で Feature と Scenario を作成する。
2. 次に Step Definition を実装し、シナリオ文と実行コードを対応付ける。
3. smoke テストなど最小タグから実行し、徐々に回帰範囲を広げる。
4. 仕様変更時は Feature を先に更新し、実装との差分をなくす。

最小コマンド例:
- JavaScript: `npx cucumber-js`

## メリット

- 仕様を読みやすい形でテスト資産化できる
- 開発・QA・業務側で共通認識を持ちやすい
- シナリオ再利用で回帰テストを整理しやすい
- E2E 以外の受け入れテストにも展開できる

## デメリット

- Step Definition が肥大化すると保守が難しい
- 文言管理ルールがないと重複が増えやすい
- BDD の運用設計が弱いと形式だけになりやすい

## 他ツールとの比較

| ツール | 主な対象 | 特徴 |
|------|------|------|
| Cucumber | BDD テスト | 仕様記述とテストを接続 |
| Robot Framework | キーワード駆動 | 非エンジニアにも扱いやすい |
| Playwright Test | Web E2E | 実装者向けで高速 |
| Cypress | Web E2E | フロントエンド体験に強い |

## ベストプラクティス

### 1. 用語辞書を統一

- Feature 文言の語彙を業務用語と一致させる
- 同義語の乱立を避ける

### 2. ステップを責務分離

- UI 操作と検証を分離する
- 共通処理は Hooks やユーティリティに集約する

### 3. タグ戦略を明確化

- `@smoke`、`@regression` など実行目的で整理する
- 重いシナリオは別タグで分離する

## 公式ドキュメント

- 公式サイト: https://cucumber.io/
- ドキュメント: https://cucumber.io/docs/
- GitHub: https://github.com/cucumber

## まとめ

1. **仕様共有** : Gherkin で仕様を記述できるため、業務要件と受け入れ条件を共有しやすい。
2. **接続性** : ステップ定義を通じて仕様と自動テストを接続し、認識差分を減らせる。
3. **長期保守** : 用語統一とタグ運用を整備すると、長期的なシナリオ保守を進めやすい。
