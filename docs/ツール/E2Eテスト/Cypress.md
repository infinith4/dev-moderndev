# Cypress

## 概要

Cypress は Web アプリ向けの E2E テストフレームワークである。ブラウザ上で実行されるためデバッグしやすく、フロントエンド開発チームがテストを実装・運用しやすい。コンポーネントテスト機能もあり、UI 品質の継続検証に向いている。

## 料金

| プラン | 内容 |
|------|------|
| OSS 版 | 無料（MIT License） |
| Cypress Cloud | ダッシュボード、並列実行、分析機能などは有料プランあり |

## 主な特徴

| 項目 | 内容 |
|------|------|
| 開発者体験 | 実行結果をブラウザで確認しながらデバッグ可能 |
| 自動待機 | 要素待機を内部で処理しフレークを抑制 |
| 豊富なアサーション | DOM やネットワーク応答を直感的に検証 |
| モック/スタブ | API 通信のインターセプトに対応 |
| クラウド連携 | 実行履歴・失敗分析を共有しやすい |

## 主な機能

### テスト実行機能

| 機能 | 説明 |
|------|------|
| E2E テスト | ユーザー操作をブラウザ上で再現 |
| コンポーネントテスト | UI 部品単位で挙動を確認 |
| タイムトラベル | 各ステップの状態を遡って確認 |
| スクリーンショット/動画 | 失敗時の証跡を保存 |

### ネットワーク制御機能

| 機能 | 説明 |
|------|------|
| リクエスト監視 | API 呼び出し内容を検証 |
| スタブ応答 | 外部 API 依存を切り離して実行 |
| フィクスチャ利用 | 固定データでテスト安定化 |
| エラー再現 | 失敗応答を意図的に返却可能 |

### 運用機能

| 機能 | 説明 |
|------|------|
| ヘッドレス実行 | パイプライン向けの高速実行 |
| テスト分割 | spec 単位で実行範囲を制御 |
| レポート連携 | JUnit など外部レポーターへ接続 |
| 並列実行 | 実行時間短縮に対応 |

## インストールとセットアップ

公式URL:
- [Cypress 公式サイト](https://www.cypress.io/)
- [Cypress Docs](https://docs.cypress.io/)
- [Cypress GitHub](https://github.com/cypress-io/cypress)

セットアップの要点:
1. プロジェクトに Cypress を開発依存として追加する。
2. 初期起動で生成される設定ファイルとディレクトリ構成を整理する。
3. `baseUrl`、認証、共通コマンドを先に定義する。

## 基本的な使い方

1. 主要ユーザーフロー（ログイン、検索、登録など）を優先してシナリオ化する。
2. 共通操作は Custom Command にまとめて重複を減らす。
3. API 依存が強い箇所は `intercept` ベースで安定化する。
4. ローカルでは GUI でデバッグし、回帰はヘッドレスで実行する。

最小コマンド:
- 初期実行: `npx cypress open`
- ヘッドレス実行: `npx cypress run`

## メリット

- UI テストの実装とデバッグがしやすい
- 自動待機で flake を抑えやすい
- フロントエンドチームが運用しやすい
- 証跡（動画・画像）を残しやすい

## デメリット

- ブラウザ外機能（複数タブ制御等）に制約がある
- テストが肥大化すると実行時間が増えやすい
- 適切なモック戦略がないと不安定化しやすい

## 他ツールとの比較

| ツール | 主な対象 | 特徴 |
|------|------|------|
| Cypress | Web E2E/Component | DX が高くフロントエンド向け |
| Playwright | Web E2E | クロスブラウザ制御に強い |
| Selenium | Web 自動化全般 | 実績と言語対応が豊富 |
| Robot Framework | キーワード駆動 | 非エンジニア含めて扱いやすい |

## ベストプラクティス

### 1. シナリオを短く保つ

- 1テスト1目的で分割する
- 前提データ作成と検証を明確に分ける

### 2. 依存 API を制御

- 通信待機はエイリアスで明示する
- 不安定 API は fixture/stub を活用する

### 3. 安定実行を優先

- セレクタは `data-*` 属性を標準化する
- 固定 sleep を避け、状態待ちで制御する

## 公式ドキュメント

- 公式サイト: https://www.cypress.io/
- ドキュメント: https://docs.cypress.io/
- GitHub: https://github.com/cypress-io/cypress

## まとめ

- フロントエンド開発と相性が良く、UI 改修に対するフィードバックを短くできる。
- 通信制御や再実行機能を活用することで、E2E の安定性を高めやすい。
- CI 連携と証跡保存を組み合わせると、回帰テスト運用を継続しやすい。
