# Playwright

## 概要

Playwright は Microsoft が開発する Web E2E テストフレームワークである。Chromium、Firefox、WebKit を横断して同一シナリオを実行でき、安定した待機制御と並列実行により大規模な回帰テストにも対応しやすい。

## 料金

| プラン | 内容 |
|------|------|
| OSS 版 | 無料（Apache License 2.0） |
| 商用利用 | ライセンス上可能（組織ポリシー確認は必要） |

## 主な特徴

| 項目 | 内容 |
|------|------|
| クロスブラウザ | Chromium / Firefox / WebKit を統一実行 |
| 高速・安定 | 自動待機と並列実行で回帰テストに強い |
| 強力なデバッグ | Trace Viewer、スクリーンショット、動画対応 |
| マルチ言語 | TypeScript/JavaScript、Python、Java、.NET |
| テストランナー統合 | Playwright Test で設定を一元管理 |

## 主な機能

### テスト実行機能

| 機能 | 説明 |
|------|------|
| E2E シナリオ | ユーザー操作を高再現で自動化 |
| 並列実行 | worker 単位で高速化 |
| プロジェクト設定 | ブラウザ・デバイス条件を分けて実行 |
| リトライ | 一時的不安定に対する再実行制御 |

### デバッグ機能

| 機能 | 説明 |
|------|------|
| Trace | 失敗時の操作履歴を可視化 |
| 動画/画像 | 実行証跡を保存 |
| UI モード | ステップ実行で原因調査 |
| レポート | HTML レポートで結果を共有 |

### 運用機能

| 機能 | 説明 |
|------|------|
| 認証状態再利用 | ログインコストを削減 |
| ネットワーク制御 | リクエスト待機・モックに対応 |
| Fixture | テスト前後処理を共通化 |
| CLI 実行 | ローカルとパイプラインで統一 |

## インストールとセットアップ

公式URL:
- [Playwright 公式](https://playwright.dev/)
- [Playwright Docs](https://playwright.dev/docs/intro)
- [Playwright GitHub](https://github.com/microsoft/playwright)

セットアップの要点:
1. Playwright を開発依存として追加する。
2. ブラウザバイナリをインストールする。
3. `playwright.config` で `baseURL`、リトライ、並列度を定義する。

## 基本的な使い方

1. まず重要フローを少数の smoke シナリオで作成する。
2. クロスブラウザ設定を有効にして互換性を確認する。
3. 失敗時に Trace を必ず残す設定で運用する。
4. 安定後に回帰スイートへ段階的に拡張する。

最小コマンド:
- 初期化: `npx playwright install`
- テスト実行: `npx playwright test`

## メリット

- クロスブラウザ検証を同一基盤で運用できる
- 並列実行で大規模テストでも速度を出しやすい
- デバッグ証跡が豊富で原因調査しやすい
- 自動待機が強く安定性を確保しやすい

## デメリット

- 設定項目が多く初期設計に時間がかかる
- テスト設計が不十分だと保守コストが増える
- UI 変更多発環境では継続的なメンテが必要

## 他ツールとの比較

| ツール | 主な対象 | 特徴 |
|------|------|------|
| Playwright | Web E2E | クロスブラウザとデバッグ機能が強い |
| Cypress | Web E2E | DX とフロントエンド体験に強い |
| Selenium | Web 自動化全般 | 長期実績と言語資産が豊富 |
| Appium | モバイル E2E | 実機モバイル対応が中心 |

## ベストプラクティス

### 1. プロジェクト設定を明確化

- smoke/regression をプロジェクトまたはタグで分ける
- ブラウザ別の実行対象を整理する

### 2. フィクスチャを標準化

- 認証状態やテストデータ準備を共通化する
- テスト本体では業務シナリオに集中する

### 3. 証跡を常時活用

- 失敗時 Trace、スクリーンショット保存を必須化する
- レポートを共有して再現調査を短縮する

## 公式ドキュメント

- 公式サイト: https://playwright.dev/
- ドキュメント: https://playwright.dev/docs/intro
- GitHub: https://github.com/microsoft/playwright

## まとめ

- 単一 API で主要ブラウザを横断でき、クロスブラウザ検証を標準化しやすい。
- Trace やスクリーンショットなどの証跡機能により、失敗原因の調査を短縮できる。
- プロジェクト設定とフィクスチャを整理すると、中規模以上の回帰運用を安定化しやすい。
