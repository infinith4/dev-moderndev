# Ruff

## 概要

Ruff は Python 向けの高速 Linter/Formatter である。従来複数ツールで行っていた静的解析と整形の一部を集約でき、Python 開発の品質チェックを高速化しやすい。

## 料金

| 区分 | 内容 |
|------|------|
| Ruff 本体 | 無料（OSS） |
| 補足 | CI 実行環境コストは別途 |

## 主な特徴

| 項目 | 内容 |
|------|------|
| 高速 | 大規模コードでも短時間で実行可能 |
| 多機能 | lint と format を一体運用しやすい |
| 設定統合 | `pyproject.toml` で一元管理 |
| 導入容易 | 既存 Python プロジェクトへ導入しやすい |
| CI 向き | 短時間チェックでパイプライン安定化 |

## 主な機能

### 解析機能

| 機能 | 説明 |
|------|------|
| コード品質検査 | 規約違反や潜在問題を検出 |
| import 整理 | import 順序や未使用を検出 |
| ルール選択 | 必要ルールのみ有効化可能 |
| ignore 制御 | 例外箇所を限定管理 |

### 整形機能

| 機能 | 説明 |
|------|------|
| フォーマット | ルールに沿って整形 |
| チェックモード | 変更せず整形漏れ検出 |
| 既存運用置換 | 一部ツールを統合可能 |
| 一貫出力 | 差分揺れを抑制 |

### 運用機能

| 機能 | 説明 |
|------|------|
| pre-commit 連携 | コミット前品質チェック |
| CI 実行 | lint/format 検証を自動化 |
| ルール段階導入 | 既存コードへ適用しやすい |
| 保守性向上 | ルール集中管理で運用簡素化 |

## インストールとセットアップ

公式URL:
- [Ruff 公式](https://docs.astral.sh/ruff/)
- [Ruff GitHub](https://github.com/astral-sh/ruff)

セットアップ手順:
1. 開発依存に Ruff を追加する。
2. `pyproject.toml` でルールと除外設定を定義する。
3. pre-commit と CI の両方へチェックを組み込む。

## 基本的な使い方

1. 初期導入時はチェックのみで課題を把握する。
2. 自動修正可能な項目から順に修正する。
3. 整形機能を導入する場合は既存整形ツールとの役割を整理する。
4. 例外ルールは最小限にして継続的に見直す。

最小コマンド:
- 解析: `ruff check .`
- 整形: `ruff format .`

## メリット

- Python 品質チェックを高速化できる
- ツール統合で運用を簡素化しやすい
- CI 時間短縮に寄与する
- 段階導入がしやすい

## デメリット

- 既存ルールセットとの調整が必要
- 全ての既存ツール機能を完全代替できるとは限らない
- 導入初期に大量警告が出る場合がある

## 他ツールとの比較

| ツール | 主な用途 | 特徴 |
|------|------|------|
| Ruff | Python lint/format | 高速・統合運用が強み |
| Flake8 | Python lint | プラグイン資産が豊富 |
| Black | Python format | 強制整形に特化 |
| mypy | 型検証 | 型安全性に特化 |

## ベストプラクティス

### 1. 既存運用と段階統合

- まず lint を導入して安定化する
- 必要に応じて format まで統合する

### 2. ルールを最小から拡張

- 重大ルール優先で適用する
- ノイズの多いルールは調整する

### 3. 自動化を徹底

- pre-commit と CI を併用する
- ローカルと CI で同一設定を使う

## 公式ドキュメント

- 公式: https://docs.astral.sh/ruff/
- GitHub: https://github.com/astral-sh/ruff
- 設定: https://docs.astral.sh/ruff/settings/

## まとめ

1. ** 高速化 ** : Ruff は Python 品質検査を高速化できる有力ツール。
2. ** 段階性 ** : 段階導入とルール調整で運用負荷を抑えられる。
3. ** 自動化 ** : 自動化連携で継続的な品質維持がしやすい。
