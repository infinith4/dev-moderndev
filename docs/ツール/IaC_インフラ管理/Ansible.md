# Ansible

## 概要

Ansible はエージェントレスでサーバー構成管理と自動化を行う IaC ツールである。SSH ベースで複数サーバーへ同一設定を適用でき、構成の標準化と運用作業の自動化に向いている。

## 料金

| プラン | 内容 |
|------|------|
| OSS 版 | 無料（GPLv3） |
| Red Hat Ansible Automation Platform | エンタープライズ向け有料サブスクリプション |

## 主な特徴

| 項目 | 内容 |
|------|------|
| エージェントレス | 管理対象に専用エージェント不要 |
| YAML 記述 | Playbook で可読性の高い自動化定義 |
| 冪等性 | 同じ Playbook を再実行しても状態を維持 |
| 豊富なモジュール | OS、クラウド、ミドルウェア操作に対応 |
| 運用統合 | 定期実行やジョブ管理と組み合わせやすい |

## 主な機能

### 構成管理機能

| 機能 | 説明 |
|------|------|
| Playbook | 手順を宣言的に定義 |
| Inventory | 対象サーバー群を管理 |
| Role | 再利用可能な設定単位に分離 |
| Variables | 環境差分を吸収 |

### 自動化機能

| 機能 | 説明 |
|------|------|
| 一括適用 | 複数ホストへ同時実行 |
| 条件分岐 | ホスト属性や変数で処理分岐 |
| ハンドラー | 設定変更時のみサービス再起動 |
| タグ実行 | 必要タスクだけ部分実行 |

### 運用機能

| 機能 | 説明 |
|------|------|
| ドライラン | 変更予定を事前確認 |
| Vault | シークレット暗号化 |
| ログ出力 | 実行結果の追跡 |
| テスト連携 | lint や Molecule との連携 |

## インストールとセットアップ

公式URL:
- [Ansible 公式](https://www.ansible.com/)
- [Ansible Documentation](https://docs.ansible.com/)
- [Ansible GitHub](https://github.com/ansible/ansible)

セットアップの要点:
1. 実行ノードに Ansible をインストールする。
2. `inventory` と `playbook` のディレクトリ構成を決める。
3. SSH 鍵、権限、接続先グループを先に整理する。

## 基本的な使い方

1. 管理対象ホストを Inventory に登録する。
2. まず最小 Playbook で疎通確認と共通設定適用を行う。
3. 次に Role 化して再利用性を高める。
4. 本番適用前に `--check` で差分確認する。

最小コマンド:
- 接続確認: `ansible all -i inventory -m ping`
- Playbook 実行: `ansible-playbook -i inventory site.yml`

## メリット

- 導入コストが低く、既存環境へ段階導入しやすい
- 構成の再現性を高めやすい
- 運用作業を標準化しやすい
- モジュールが豊富で拡張しやすい

## デメリット

- 大規模環境では実行時間や運用設計に工夫が必要
- Playbook 設計が不十分だと保守性が下がる
- 手続き的な記述が増えると複雑化しやすい

## 他ツールとの比較

| ツール | 主な対象 | 特徴 |
|------|------|------|
| Ansible | 構成管理/運用自動化 | エージェントレスで導入しやすい |
| Terraform | インフラプロビジョニング | リソース定義と状態管理に強い |
| Chef | 構成管理 | Ruby ベースで柔軟性が高い |
| Puppet | 構成管理 | 大規模運用で実績が豊富 |

## ベストプラクティス

### 1. Role 単位で分離

- OS 基盤、ミドルウェア、アプリ設定を分ける
- 変更影響を局所化する

### 2. 変数管理を明確化

- 環境変数は `group_vars` / `host_vars` に分離する
- 機密情報は Vault で暗号化する

### 3. 事前検証を標準化

- `--check` と lint を実行してから本番反映する
- 失敗時ロールバック手順を用意する

## 公式ドキュメント

- 公式サイト: https://www.ansible.com/
- ドキュメント: https://docs.ansible.com/
- GitHub: https://github.com/ansible/ansible

## まとめ

Ansible はサーバー構成管理と運用自動化を段階的に整備しやすい IaC ツールである。既存サーバー群を標準化し、手作業を減らしたいチームに適している。
