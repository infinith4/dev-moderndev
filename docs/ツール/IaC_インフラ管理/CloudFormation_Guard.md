# CloudFormation Guard

## 概要

CloudFormation Guard（cfn-guard）は CloudFormation テンプレートに対するポリシー検証ツールである。事前に定義したルールでテンプレートをチェックし、セキュリティや運用基準に反する設定をデプロイ前に検出できる。

## 料金

| プラン | 内容 |
|------|------|
| OSS 版 | 無料 |
| 商用利用 | ライセンス上可能（組織ポリシー確認は必要） |

## 主な特徴

| 項目 | 内容 |
|------|------|
| ポリシー検証 | CloudFormation テンプレートをルールで評価 |
| 早期検出 | デプロイ前に違反を検知 |
| AWS 親和性 | CloudFormation 運用に直接組み込み可能 |
| ルール再利用 | 組織標準ルールを共有しやすい |
| CLI 運用 | ローカルと自動実行で共通化しやすい |

## 主な機能

### ルール管理機能

| 機能 | 説明 |
|------|------|
| Guard ルール記述 | 必須タグや暗号化設定を宣言 |
| ルールセット化 | 複数基準をまとめて適用 |
| バージョン管理 | ルール変更履歴を追跡 |
| 例外管理 | 対象除外や条件分岐を設定 |

### 検証機能

| 機能 | 説明 |
|------|------|
| テンプレート検証 | JSON/YAML を入力として評価 |
| 失敗箇所表示 | どのルールで違反したか明示 |
| 複数ファイル評価 | テンプレート群を一括検証 |
| レポート出力 | 合否結果を確認しやすい |

### 運用機能

| 機能 | 説明 |
|------|------|
| ローカルチェック | 開発時に即時フィードバック |
| 事前品質ゲート | デプロイ前の必須チェックに設定 |
| 標準化推進 | セキュリティ基準の徹底 |
| 監査補助 | ルール適用証跡を残しやすい |

## インストールとセットアップ

公式URL:
- [CloudFormation Guard Docs](https://docs.aws.amazon.com/cfn-guard/)
- [CloudFormation Guard GitHub](https://github.com/aws-cloudformation/cloudformation-guard)

セットアップの要点:
1. cfn-guard CLI を導入する。
2. 組織標準のルールファイルを作成する。
3. テンプレート保管場所とルール適用対象を定義する。

## 基本的な使い方

1. まず最低限のセキュリティルール（暗号化、公開範囲、タグ）を作成する。
2. テンプレートを対象に `validate` を実行して違反を確認する。
3. ルール違反を修正して再検証する。
4. プロジェクト共通ルールとしてリポジトリ管理する。

最小コマンド:
- 検証: `cfn-guard validate -r rules.guard -d template.yaml`

## メリット

- デプロイ前に違反設定を検出できる
- 組織ルールを一貫適用しやすい
- CloudFormation 運用の品質を上げやすい
- 監査向けの基準明文化に役立つ

## デメリット

- ルール設計と保守に継続コストがかかる
- 高度な条件は記述が複雑になりやすい
- CloudFormation 以外には直接適用できない

## 他ツールとの比較

| ツール | 主な対象 | 特徴 |
|------|------|------|
| CloudFormation Guard | CloudFormation ポリシー検証 | AWS テンプレート検証に特化 |
| OPA | 汎用ポリシー評価 | 多対象に適用可能 |
| Checkov | IaC セキュリティスキャン | 複数 IaC を横断チェック |
| tflint | Terraform lint | Terraform 向け静的解析 |

## ベストプラクティス

### 1. ルールを段階導入

- 重大違反ルールから先に導入する
- 違反が減ったら対象範囲を広げる

### 2. ルールを共通資産化

- チーム共通ルールを中央管理する
- 変更時はレビューを必須化する

### 3. 例外管理を明文化

- 一時例外の期限と理由を記録する
- 恒久例外を最小化する

## 公式ドキュメント

- ドキュメント: https://docs.aws.amazon.com/cfn-guard/
- GitHub: https://github.com/aws-cloudformation/cloudformation-guard

## まとめ

1. ** 事前検証 ** : CloudFormation テンプレートの事前ポリシー検証を強化するツールである。
2. ** 統制力 ** : 組織標準ルールを一貫適用し、AWS IaC の品質と統制を高めやすい。
3. ** 早期検出 ** : デプロイ前に違反設定を検出し、監査向けの基準明文化に役立つ。
