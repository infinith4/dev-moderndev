# Velero

## 概要

Velero は Kubernetes クラスタのリソースと永続ボリュームをバックアップ/リストアするためのツールである。災害復旧やクラスタ移行の準備として利用され、クラスタ運用の復旧性を高めやすい。

## 料金

| プラン | 内容 |
|------|------|
| OSS 版 | 無料（Apache License 2.0） |
| 補足 | バックアップ保存先ストレージ利用料は別途発生 |

## 主な特徴

| 項目 | 内容 |
|------|------|
| Kubernetes 特化 | クラスタリソースの保全に最適化 |
| バックアップ自動化 | スケジュール実行で定期取得可能 |
| リストア対応 | Namespace 単位など柔軟に復元 |
| マルチクラウド | S3 互換など複数保存先に対応 |
| 移行支援 | クラスタ間移行時のデータ移送に活用可能 |

## 主な機能

### バックアップ機能

| 機能 | 説明 |
|------|------|
| クラスタリソース保存 | Kubernetes オブジェクトを取得 |
| 永続ボリューム保全 | Volume Snapshot 連携 |
| スケジュール実行 | 定期バックアップを自動化 |
| 選択バックアップ | namespace/label 指定で対象制御 |

### リストア機能

| 機能 | 説明 |
|------|------|
| フルリストア | クラスタ全体復元 |
| 部分リストア | 対象リソースのみ復元 |
| リソース変換 | 復元時に一部マッピング変更 |
| 復元監視 | ステータス確認で完了判定 |

### 運用機能

| 機能 | 説明 |
|------|------|
| バックアップ保存先管理 | オブジェクトストレージを利用 |
| 監査補助 | バックアップ履歴を確認 |
| ポリシー運用 | 保持期間・世代管理を設定 |
| 障害訓練 | 定期リストア訓練に活用 |

## インストールとセットアップ

公式URL:
- [Velero 公式](https://velero.io/)
- [Velero Docs](https://velero.io/docs/)
- [Velero GitHub](https://github.com/vmware-tanzu/velero)

セットアップの要点:
1. バックアップ先ストレージと認証情報を準備する。
2. Velero サーバーをクラスタへ導入する。
3. バックアップ対象範囲と保持ポリシーを定義する。

## 基本的な使い方

1. まず単発バックアップを作成し復元可能性を確認する。
2. 重要 namespace ごとにスケジュールバックアップを設定する。
3. 定期的にリストア訓練を行い、復旧手順を検証する。
4. 保持期間と世代数を運用方針に合わせて調整する。

最小コマンド:
- バックアップ作成: `velero backup create sample-backup --include-namespaces app`
- 復元実行: `velero restore create --from-backup sample-backup`

## メリット

- Kubernetes 復旧手順を標準化しやすい
- 定期バックアップを自動化できる
- クラスタ移行時のリスク低減に有効
- リソース単位で復元範囲を制御できる

## デメリット

- ストレージ・権限設計の初期負荷がある
- 復元検証を怠ると実運用で失敗しやすい
- 永続データ整合性には追加設計が必要な場合がある

## 他ツールとの比較

| ツール | 主な対象 | 特徴 |
|------|------|------|
| Velero | Kubernetes バックアップ/復元 | クラスタ復旧に特化 |
| etcd backup | K8s 制御面バックアップ | 低レベル復旧向け |
| Kasten K10 | Kubernetes DR | 商用機能が充実 |
| Stash | K8s バックアップ | Kubernetes 連携に対応 |

## ベストプラクティス

### 1. 復元テストを定期実施

- バックアップ取得だけで終わらせない
- 四半期ごとに復旧訓練を実施する

### 2. 保存ポリシーを明確化

- 保持世代と期間を事前定義する
- コストと復旧要件のバランスを取る

### 3. バックアップ対象を分類

- ミッションクリティカル領域を優先保護する
- 除外対象を明示してノイズを減らす

## 公式ドキュメント

- 公式サイト: https://velero.io/
- ドキュメント: https://velero.io/docs/
- GitHub: https://github.com/vmware-tanzu/velero

## まとめ

Velero は Kubernetes 運用の復旧性を高めるための標準的なバックアップツールである。災害復旧やクラスタ移行を計画的に進めたいチームに適している。
