# tflint

## 概要

tflint は Terraform 向けの静的解析ツールである。構文だけでなく、クラウドごとのベストプラクティスや誤設定を検出できるため、`terraform plan` 前に品質問題を早期に見つけやすい。

## 料金

| プラン | 内容 |
|------|------|
| OSS 版 | 無料（MPL 2.0） |
| 商用利用 | ライセンス上可能（組織ポリシー確認は必要） |

## 主な特徴

| 項目 | 内容 |
|------|------|
| Terraform 特化 | HCL の問題を早期検出 |
| ルール拡張 | プラグインでクラウドルールを追加可能 |
| 高速実行 | 開発時に繰り返し実行しやすい |
| 自動化向き | pre-commit や CI に組み込みやすい |
| 設定柔軟性 | ルール有効/無効を細かく調整可能 |

## 主な機能

### 解析機能

| 機能 | 説明 |
|------|------|
| 構文/品質チェック | Terraform 定義の問題を検出 |
| プロバイダルール | AWS/Azure/GCP 向けルール適用 |
| 変数利用確認 | 未使用や未定義の検出 |
| 命名規則確認 | チーム規約に沿った整合性確認 |

### 運用機能

| 機能 | 説明 |
|------|------|
| `.tflint.hcl` 設定 | ルールセットをプロジェクト標準化 |
| プラグイン管理 | 必要ルールを選択導入 |
| 出力形式 | CI 向けの結果出力 |
| 反復実行 | 修正後の再チェックが容易 |

### 品質強化機能

| 機能 | 説明 |
|------|------|
| pre-commit 連携 | ローカル段階で品質担保 |
| セキュリティ補助 | 危険設定の早期検出 |
| 他ツール連携 | tfsec/Checkov と併用可能 |
| レビュー支援 | 指摘を PR 上で共有しやすい |

## インストールとセットアップ

公式URL:
- [tflint 公式（GitHub）](https://github.com/terraform-linters/tflint)
- [tflint Docs](https://github.com/terraform-linters/tflint/blob/master/docs/user-guide.md)

セットアップの要点:
1. tflint を導入する。
2. `.tflint.hcl` を作成してルールを明示する。
3. プロバイダプラグインを初期化する。

## 基本的な使い方

1. Terraform ディレクトリで tflint を実行する。
2. 指摘内容を分類し、ルール修正かコード修正か判断する。
3. ルール例外は `.tflint.hcl` に理由付きで管理する。
4. ローカルと自動実行で同じルールセットを使う。

最小コマンド:
- 初期化: `tflint --init`
- 解析: `tflint`

## メリット

- Terraform の問題を早期検出できる
- チーム規約をコードで強制しやすい
- 実行が軽く開発ループに組み込みやすい
- PR レビュー負荷を下げやすい

## デメリット

- ルール調整に初期コストがかかる
- 誤検知や過剰検知への調整が必要
- セキュリティ網羅は他ツール併用が前提

## 他ツールとの比較

| ツール | 主な対象 | 特徴 |
|------|------|------|
| tflint | Terraform lint | 品質・規約チェックに特化 |
| terraform validate | Terraform 構文 | 基本検証のみ |
| tfsec | Terraform セキュリティ | セキュリティルールに強い |
| Checkov | IaC 横断スキャン | 複数 IaC を統合チェック |

## ベストプラクティス

### 1. ルールを段階導入

- 重大指摘ルールから有効化する
- チーム合意後に適用範囲を拡大する

### 2. 例外を可視化

- 無効化ルールには理由を残す
- 定期的に例外を見直す

### 3. 他検査と組み合わせ

- `fmt`、`validate`、`plan` と合わせて実行する
- セキュリティ検査ツールを補完利用する

## 公式ドキュメント

- GitHub: https://github.com/terraform-linters/tflint
- User Guide: https://github.com/terraform-linters/tflint/blob/master/docs/user-guide.md

## まとめ

1. **早期検出** : Terraform の品質と規約準拠を早期に担保するための実用的な lint ツールである。
2. **自動品質** : pre-commit や CI に組み込み、チーム規約をコードで強制しやすい。
3. **高速化** : 実行が軽く開発ループに組み込みやすく、PR レビュー負荷を下げられる。
