# InSpec

## 概要

InSpec はインフラとセキュリティ設定をコードで検証するためのテストフレームワークである。サーバー設定、クラウド構成、コンプライアンス要件をテストとして定義し、継続的に監査できる。

## 料金

| プラン | 内容 |
|------|------|
| OSS 版 | 無料（Apache License 2.0） |
| Chef 商用製品連携 | 有料機能・サポートあり |

## 主な特徴

| 項目 | 内容 |
|------|------|
| コンプライアンステスト | セキュリティ基準をコード化 |
| 多対象対応 | OS、クラウド、コンテナ設定を検証 |
| プロファイル再利用 | 共通監査ルールを使い回せる |
| 人が読める記法 | 意図が伝わるテスト記述 |
| 監査向け出力 | 結果を証跡として活用しやすい |

## 主な機能

### 検証機能

| 機能 | 説明 |
|------|------|
| コントロール定義 | 設定要件をテスト化 |
| リソース検査 | ファイル、サービス、ポート等を確認 |
| クラウド検査 | AWS/Azure/GCP 設定確認 |
| 失敗レポート | どの要件に違反したか可視化 |

### プロファイル運用機能

| 機能 | 説明 |
|------|------|
| プロファイル分割 | 基盤、ミドルウェア等で整理 |
| 継承/再利用 | 共通基準を共有 |
| 例外管理 | 一時的な許容条件を管理 |
| バージョン管理 | 監査基準の変更履歴を保持 |

### 品質強化機能

| 機能 | 説明 |
|------|------|
| セキュリティ検証 | CIS など基準適合確認 |
| 監査対応 | 定期レポート出力に利用 |
| 早期検出 | 構成逸脱を早めに把握 |
| 自動評価 | 継続的テスト運用に適合 |

## インストールとセットアップ

公式URL:
- [InSpec 公式](https://www.chef.io/products/chef-inspec)
- [InSpec Docs](https://docs.chef.io/inspec/)
- [InSpec GitHub](https://github.com/inspec/inspec)

セットアップの要点:
1. InSpec CLI を導入する。
2. 検証対象ごとにプロファイル構成を定義する。
3. 組織標準のセキュリティ要件をコントロール化する。

## 基本的な使い方

1. 最初に必須要件（ユーザー、SSH、パッケージ、暗号化）を定義する。
2. 対象環境へ `exec` で評価を実行する。
3. 失敗項目を修正し、再評価で改善確認する。
4. 監査用途では評価結果を定期保存する。

最小コマンド:
- 実行: `inspec exec profiles/base -t ssh://user@host`

## メリット

- セキュリティ要件をコードで管理できる
- 監査証跡を継続的に残しやすい
- 設定逸脱を早期に検知できる
- 再利用可能な監査プロファイルを構築できる

## デメリット

- 監査要件の定義・保守に時間がかかる
- 対象環境が増えると実行管理が複雑化する
- 例外運用が曖昧だと基準が形骸化しやすい

## 他ツールとの比較

| ツール | 主な対象 | 特徴 |
|------|------|------|
| InSpec | インフラ/セキュリティ監査 | コンプライアンス検証に強い |
| OPA | 汎用ポリシー評価 | 多対象に横断適用できる |
| CloudFormation Guard | CFn 検証 | AWS テンプレートに特化 |
| Terratest | IaC 統合テスト | 実行時検証に強い |

## ベストプラクティス

### 1. 基準を優先順位付け

- 重大要件から段階導入する
- 監査対象を明確に限定する

### 2. プロファイルを分離

- OS 共通とサービス個別で分ける
- 変更頻度の高いルールを独立させる

### 3. 例外ルールを管理

- 例外は期限と理由を必須化する
- 定期的に例外を棚卸しする

## 公式ドキュメント

- 公式サイト: https://www.chef.io/products/chef-inspec
- ドキュメント: https://docs.chef.io/inspec/
- GitHub: https://github.com/inspec/inspec

## まとめ

1. ** 監査性 ** : インフラ設定とコンプライアンス要件を継続的に検証するための実践的ツールである。
2. ** 再利用 ** : プロファイルを共有・継承して組織標準の監査基準を効率的に運用できる。
3. ** 早期検出 ** : 構成逸脱を早期に検知し、監査証跡を継続的に残しやすい。
