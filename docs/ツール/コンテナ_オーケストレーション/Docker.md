# Docker

## 概要

Docker は、アプリケーションと依存関係をコンテナとしてパッケージ化し、環境差分を抑えて実行できるプラットフォームである。Dockerfile と Docker Compose を使い、開発環境の標準化からCI/CDまで一貫して運用しやすい。

## 料金

| プラン | 内容 |
|------|------|
| Docker Engine (Linux) | 無料（オープンソース） |
| Docker Desktop | 無料枠あり（組織規模・用途により有料プランあり） |
| Docker Hub | 無料枠あり（プライベートリポジトリや同時ビルドで有料機能あり） |

## 主な特徴

| 項目 | 内容 |
|------|------|
| 環境一貫性 | 開発・検証・本番で同一実行環境を再現しやすい |
| 軽量実行 | 仮想マシンより起動が速く、リソース効率が高い |
| イメージ管理 | タグでバージョン管理し、配布しやすい |
| Compose 運用 | 複数コンテナを宣言的に起動・停止できる |
| レジストリ連携 | Docker Hub や private registry へ配布可能 |
| CI/CD 親和性 | ビルド、テスト、デプロイ工程へ組み込みやすい |

## 主な機能

### コンテナ実行機能

| 機能 | 説明 |
|------|------|
| `docker run` | コンテナを単体で起動 |
| ポート公開 | ホストとコンテナ間の通信を設定 |
| ボリューム | データ永続化とファイル共有 |
| ネットワーク | コンテナ間接続と分離を制御 |

### イメージ管理機能

| 機能 | 説明 |
|------|------|
| Dockerfile | ビルド手順をコードとして管理 |
| マルチステージビルド | 最終イメージを小さく保ちやすい |
| タグ運用 | `latest` 以外にバージョン固定が可能 |
| レジストリ push/pull | イメージの配布と再利用 |

### 開発運用機能

| 機能 | 説明 |
|------|------|
| Docker Compose | アプリ、DB、キャッシュをまとめて定義 |
| ログ確認 | `docker logs` で実行状態を確認 |
| 実行中調査 | `docker exec` で内部確認 |
| クリーンアップ | 不要コンテナ/イメージを整理 |

## インストールとセットアップ

公式URL:
- [Docker 公式サイト](https://www.docker.com/)
- [Docker Desktop](https://www.docker.com/products/docker-desktop/)
- [Docker Docs](https://docs.docker.com/)
- [Docker Hub](https://hub.docker.com/)

セットアップの要点:
1. 開発端末に Docker Desktop（または Linux で Docker Engine）を導入する。
2. `docker --version` と `docker run hello-world` で動作確認する。
3. プロジェクトに `Dockerfile` と `docker-compose.yml` を追加する。
4. CI でイメージビルドとテスト実行を標準化する。

## 基本的な使い方

1. `Dockerfile` を作成してアプリのビルド手順を定義する。
2. `docker build` でイメージを作成する。
3. `docker run` でコンテナを起動し、動作確認する。
4. 複数サービスは `docker compose up` でまとめて起動する。
5. 検証後に `docker compose down` で停止し、リソースを解放する。

最小実行例:
- ビルド: `docker build -t myapp:1.0 .`
- 単体起動: `docker run -d -p 3000:3000 myapp:1.0`
- 複数起動: `docker compose up -d`

## メリット

- 環境差分を減らし、再現性の高い開発・検証を進めやすい。
- Compose により依存サービス込みの起動手順を共有しやすい。
- イメージ配布でCI/CDとデプロイ工程を標準化しやすい。

## デメリット

- ボリューム、ネットワーク、権限設定に学習コストがある。
- ホストOSによっては実行オーバーヘッドが発生しやすい。
- イメージ肥大化や脆弱性混入を防ぐ運用設計が必要。

## Docker での使用

`docker-compose` ではアプリ、DB、キャッシュを同一定義で管理し、開発環境の再現性を高める。チームでは compose ファイルと起動コマンドを統一し、オンボーディングと障害再現を簡素化すると運用しやすい。

## 他ツールとの比較

| ツール | 主な対象 | 特徴 |
|------|------|------|
| Docker | コンテナ化とローカル運用 | 開発から配布までの標準基盤 |
| Podman | デーモンレス実行 | rootless 運用に強い |
| Kubernetes | 大規模オーケストレーション | 本番運用の自動復旧・スケーリングに強い |
| Rancher | K8s 管理統合 | 複数クラスタ管理と運用GUIを提供 |

## ベストプラクティス

### 1. Dockerfile を最小化

- マルチステージビルドで不要ファイルを除外する。
- ベースイメージは固定タグで管理する。

### 2. Compose を環境別に分離

- 開発用と本番用で compose 設定を分ける。
- 機密情報は `.env` とシークレット管理で扱う。

### 3. セキュリティと品質を自動化

- CI でイメージスキャンと lint を実行する。
- 未使用イメージを定期的にクリーンアップする。

## 公式ドキュメント

- 公式サイト: https://www.docker.com/
- Docker Docs: https://docs.docker.com/
- Docker Desktop: https://www.docker.com/products/docker-desktop/
- Docker Hub: https://hub.docker.com/

## まとめ

1. ** 再現性 ** : コンテナ化により、開発から本番までの環境差分を減らしやすい。
2. ** 標準化 ** : Dockerfile と Compose の標準化で、チーム開発の再現性を高めやすい。
3. ** 継続品質 ** : CI/CD とセキュリティ運用を組み合わせると、継続的な品質維持を進めやすい。
