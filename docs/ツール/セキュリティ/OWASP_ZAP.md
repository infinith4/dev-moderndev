# OWASP ZAP (Zed Attack Proxy)

## 概要

OWASP ZAP は、Webアプリケーションの脆弱性を検査するオープンソースのセキュリティテストツールである。プロキシ経由の手動検証と自動スキャンを組み合わせ、XSS、SQL Injection などの一般的なリスクを検出しやすい。

## 料金

| プラン | 内容 |
|------|------|
| OWASP ZAP | 無料（Apache License 2.0） |
| 商用利用 | ライセンス上可能（組織ポリシー確認は必要） |

## 主な特徴

| 項目 | 内容 |
|------|------|
| Web脆弱性検査 | OWASP Top 10 観点の検査に活用しやすい |
| 自動/手動併用 | 自動スキャンと手動検証を同一ツールで実施可能 |
| プロキシ型分析 | 実トラフィックを観測して攻撃面を把握しやすい |
| APIスキャン | OpenAPI/GraphQL などAPI検査に対応 |
| CI/CD統合 | Docker/CLI でパイプライン実行可能 |
| レポート出力 | HTML、JSON などで結果共有可能 |

## 主な機能

### スキャン機能

| 機能 | 説明 |
|------|------|
| パッシブスキャン | 通信観測ベースで低負荷に問題検出 |
| アクティブスキャン | 攻撃パターンを送信して脆弱性検証 |
| スパイダー | URL探索で対象面を網羅 |
| AJAXスパイダー | JS駆動画面の探索を補完 |

### 検証支援機能

| 機能 | 説明 |
|------|------|
| セッション管理 | ログイン状態を保持した検査 |
| コンテキスト設定 | 対象範囲/除外範囲を制御 |
| スクリプト拡張 | 認証やテスト手順を拡張可能 |
| アラート管理 | リスク/確度で優先度付け |

### 自動化機能

| 機能 | 説明 |
|------|------|
| Baseline Scan | 回帰向けの軽量チェック |
| Full Scan | 深い検査を自動実行 |
| API Scan | 仕様ベースのAPI脆弱性検査 |
| CI 連携 | ジョブ失敗条件を設定可能 |

## インストールとセットアップ

公式URL:
- [OWASP ZAP 公式サイト](https://www.zaproxy.org/)
- [ドキュメント](https://www.zaproxy.org/docs/)
- [GitHub](https://github.com/zaproxy/zaproxy)
- [Docker Image](https://github.com/zaproxy/zaproxy/pkgs/container/zaproxy)

セットアップの要点:
1. デスクトップ版または Docker 版を導入する。
2. 対象環境に合わせてコンテキスト（対象/除外）を設定する。
3. 認証が必要な場合はログイン処理を事前設定する。
4. Baseline と Full の使い分けをCI方針として定義する。

## 基本的な使い方

1. 対象URLを設定し、スパイダーでページ構造を収集する。
2. まずパッシブスキャンで低リスクに確認する。
3. 必要に応じてアクティブスキャンを実行する。
4. アラートをリスク順に確認し、修正計画へ反映する。
5. レポートを保存し、再検査で改善を確認する。

最小実行例:
- Baseline: `zap-baseline.py -t https://example.com -r zap-report.html`
- Full Scan: `zap-full-scan.py -t https://example.com -r zap-full.html`

## メリット

- 無料で本格的なWeb脆弱性検査を実施しやすい。
- 自動スキャンと手動検証を一体運用しやすい。
- CI連携で継続的なセキュリティテストを回しやすい。

## デメリット

- 誤検知が出るため、結果のトリアージが必要。
- 大規模サイトや認証付きサイトは設定工数が増える。
- 深いアクティブスキャンは対象環境へ負荷を与えやすい。

## Docker での使用

Docker イメージで `baseline` / `full` / `api` スキャンを実行すると、環境差分を抑えて CI へ組み込みやすい。実運用では対象URL、除外ルール、失敗条件をジョブ定義へ固定化すると運用が安定する。

## 他ツールとの比較

| ツール | 主な対象 | 特徴 |
|------|------|------|
| OWASP ZAP | Webアプリ脆弱性検査 | 自動/手動の併用運用に強い |
| Burp Suite | ペンテスト高度分析 | 手動検証機能が豊富（商用中心） |
| Nuclei | テンプレート検査 | 高速な大規模スキャンに強い |
| Nikto | Webサーバー検査 | サーバー設定の基本検査向け |

## ベストプラクティス

### 1. スキャン範囲を明確化

- 本番相当環境で対象URLと除外URLを定義する。
- 誤検査を防ぐためログアウト/管理画面を制御する。

### 2. 段階的な自動化

- PRでは Baseline、夜間で Full Scan を使い分ける。
- 失敗条件は Critical/High から段階導入する。

### 3. トリアージを運用化

- 検出結果をチケット化し、再発防止まで追跡する。
- 誤検知はルール化して継続改善する。

## 公式ドキュメント

- 公式サイト: https://www.zaproxy.org/
- ドキュメント: https://www.zaproxy.org/docs/
- GitHub: https://github.com/zaproxy/zaproxy
- Docker: https://github.com/zaproxy/zaproxy/pkgs/container/zaproxy

## まとめ

- Webアプリの脆弱性を自動/手動で継続的に検査しやすい。
- Docker/CLI 連携により、CI/CD へ組み込みやすい。
- スキャン範囲と失敗条件を標準化すると運用品質を保ちやすい。
