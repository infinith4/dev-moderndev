# Nock

## æ¦‚è¦

**Nock** ã¯ã€Node.jsç’°å¢ƒã§HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ¢ãƒƒã‚¯ãƒ»ã‚¹ã‚¿ãƒ–åŒ–ã™ã‚‹ãŸã‚ã®å¼·åŠ›ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚å¤–éƒ¨HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å®Œå…¨ã«åˆ¶å¾¡ã—ã€ãƒ†ã‚¹ãƒˆã®ä¿¡é ¼æ€§ã¨å®Ÿè¡Œé€Ÿåº¦ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®è¨˜éŒ²ãƒ»å†ç”Ÿæ©Ÿèƒ½ã«ã‚ˆã‚Šã€å®Ÿéš›ã®APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç°¡å˜ã«ãƒ¢ãƒƒã‚¯åŒ–ã§ãã¾ã™ã€‚

## åŸºæœ¬æƒ…å ±

| é …ç›® | å†…å®¹ |
|------|------|
| **å…¬å¼ã‚µã‚¤ãƒˆ** | [https://github.com/nock/nock](https://github.com/nock/nock) |
| **GitHub** | [https://github.com/nock/nock](https://github.com/nock/nock) |
| **ãƒ©ã‚¤ã‚»ãƒ³ã‚¹** | MIT License |
| **é–‹ç™ºå…ƒ** | Nock Contributors |
| **å¯¾å¿œæŠ€è¡“** | Node.js / HTTP / HTTPS |
| **æ–™é‡‘** | ğŸŸ¢ ç„¡æ–™ãƒ»ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ |

## ä¸»ãªæ©Ÿèƒ½

### 1. HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆ
- ã™ã¹ã¦ã®å¤–éƒ¨HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆ
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹å®Œå…¨åˆ¶å¾¡
- å®Ÿãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ã‚»ã‚¹é˜²æ­¢

### 2. ãƒªã‚¯ã‚¨ã‚¹ãƒˆè¨˜éŒ²ãƒ»å†ç”Ÿ
- å®Ÿéš›ã®APIãƒªã‚¯ã‚¨ã‚¹ãƒˆè¨˜éŒ²
- è¨˜éŒ²ã—ãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹å†ç”Ÿ
- ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜
- ãƒªãƒ—ãƒ¬ã‚¤ãƒ¢ãƒ¼ãƒ‰

### 3. æŸ”è»Ÿãªãƒãƒƒãƒãƒ³ã‚°
- URLå®Œå…¨ä¸€è‡´ãƒ»éƒ¨åˆ†ä¸€è‡´
- HTTPãƒ¡ã‚½ãƒƒãƒ‰æŒ‡å®š
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ãƒãƒƒãƒãƒ³ã‚°
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ãƒãƒƒãƒãƒ³ã‚°

### 4. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰æŒ‡å®š
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼è¨­å®š
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£å®šç¾©
- é…å»¶ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

### 5. ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯çµ±åˆ
- Jestçµ±åˆ
- Mochaçµ±åˆ
- Avaçµ±åˆ
- Vitestçµ±åˆ

## ãƒ¡ãƒªãƒƒãƒˆãƒ»ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ

### ãƒ¡ãƒªãƒƒãƒˆ âœ…

- **ç„¡æ–™ãƒ»ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹** - ãƒ©ã‚¤ã‚»ãƒ³ã‚¹è²»ç”¨ä¸è¦
- **Node.jsãƒ†ã‚¹ãƒˆæœ€é©åŒ–** - Node.jsç’°å¢ƒã«ç‰¹åŒ–
- **HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆå®Œå…¨åˆ¶å¾¡** - ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆåˆ¶å¾¡å¯èƒ½
- **ãƒªã‚¯ã‚¨ã‚¹ãƒˆè¨˜éŒ²ãƒ»å†ç”Ÿ** - å®ŸAPIãƒ¬ã‚¹ãƒãƒ³ã‚¹æ´»ç”¨
- **Jest/Mochaçµ±åˆå®¹æ˜“** - ä¸»è¦ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯å¯¾å¿œ
- **è»½é‡ã§é«˜é€Ÿ** - ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰æœ€å°é™
- **å……å®Ÿã—ãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ** - å­¦ç¿’ã—ã‚„ã™ã„

### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ âŒ

- **Node.jså°‚ç”¨** - ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒéå¯¾å¿œ
- **ãƒ–ãƒ©ã‚¦ã‚¶éå¯¾å¿œ** - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºã«ã¯åˆ¥ãƒ„ãƒ¼ãƒ«å¿…è¦
- **ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ã‚µãƒ¼ãƒã§ã¯ãªã„** - ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰åŸ‹ã‚è¾¼ã¿å‹
- **GraphQLå¯¾å¿œé™å®šçš„** - REST APIä¸­å¿ƒ

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ»ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### npm/yarn/pnpmã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# npm
npm install --save-dev nock

# yarn
yarn add --dev nock

# pnpm
pnpm add -D nock
```

### åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•

```javascript
const nock = require('nock')

// HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ¢ãƒƒã‚¯
nock('https://api.example.com')
  .get('/users/123')
  .reply(200, {
    id: '123',
    name: 'John Doe',
    email: 'john@example.com'
  })

// å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œ
const response = await fetch('https://api.example.com/users/123')
const data = await response.json()
// data = { id: '123', name: 'John Doe', email: 'john@example.com' }
```

## å®Ÿè·µä¾‹

### åŸºæœ¬çš„ãªGETãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¢ãƒƒã‚¯

```javascript
const nock = require('nock')
const axios = require('axios')

describe('User API', () => {
  test('ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—', async () => {
    // ãƒ¢ãƒƒã‚¯è¨­å®š
    nock('https://api.example.com')
      .get('/users/123')
      .reply(200, {
        id: '123',
        name: 'John Doe'
      })

    // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
    const response = await axios.get('https://api.example.com/users/123')

    expect(response.data.id).toBe('123')
    expect(response.data.name).toBe('John Doe')
  })
})
```

### POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ¢ãƒƒã‚¯

```javascript
nock('https://api.example.com')
  .post('/users', {
    name: 'Jane Doe',
    email: 'jane@example.com'
  })
  .reply(201, {
    id: '456',
    name: 'Jane Doe',
    email: 'jane@example.com',
    createdAt: '2025-01-01T00:00:00Z'
  })
```

### ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã®ãƒãƒƒãƒãƒ³ã‚°

```javascript
nock('https://api.example.com')
  .get('/protected')
  .matchHeader('authorization', 'Bearer token123')
  .reply(200, { data: 'protected data' })
```

### ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒãƒƒãƒãƒ³ã‚°

```javascript
nock('https://api.example.com')
  .get('/users')
  .query({ page: 1, limit: 10 })
  .reply(200, {
    users: [/* ... */],
    total: 100
  })
```

### ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ¢ãƒƒã‚¯

```javascript
nock('https://api.example.com')
  .get('/users/999')
  .reply(404, {
    error: 'User not found'
  })

// ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼
nock('https://api.example.com')
  .get('/timeout')
  .replyWithError('Network timeout')
```

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹é…å»¶ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

```javascript
nock('https://api.example.com')
  .get('/slow')
  .delay(2000) // 2ç§’é…å»¶
  .reply(200, { data: 'slow response' })
```

### ãƒªã‚¯ã‚¨ã‚¹ãƒˆè¨˜éŒ²ãƒ»å†ç”Ÿ

```javascript
const nock = require('nock')

// ãƒªã‚¯ã‚¨ã‚¹ãƒˆè¨˜éŒ²ãƒ¢ãƒ¼ãƒ‰
nock.recorder.rec({
  output_objects: true,
  dont_print: true
})

// å®Ÿéš›ã®APIãƒªã‚¯ã‚¨ã‚¹ãƒˆå®Ÿè¡Œ
await fetch('https://api.example.com/users/123')

// è¨˜éŒ²ã—ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆå–å¾—
const recordings = nock.recorder.play()

// ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜
const fs = require('fs')
fs.writeFileSync('fixtures/users.json', JSON.stringify(recordings, null, 2))
```

```javascript
// è¨˜éŒ²ã—ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å†ç”Ÿ
const fixtures = require('./fixtures/users.json')

fixtures.forEach(fixture => {
  nock(fixture.scope)
    .intercept(fixture.path, fixture.method)
    .reply(fixture.status, fixture.response)
})
```

## ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### ãƒ†ã‚¹ãƒˆå¾Œã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

```javascript
const nock = require('nock')

describe('API Tests', () => {
  afterEach(() => {
    // ã™ã¹ã¦ã®ãƒ¢ãƒƒã‚¯ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
    nock.cleanAll()
  })

  test('ãƒ†ã‚¹ãƒˆ1', async () => {
    nock('https://api.example.com')
      .get('/resource')
      .reply(200, { data: 'test' })

    // ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰...
  })
})
```

### ãƒ¢ãƒƒã‚¯æœªä½¿ç”¨æ¤œå‡º

```javascript
afterEach(() => {
  // æœªä½¿ç”¨ã®ãƒ¢ãƒƒã‚¯ã‚’æ¤œå‡º
  if (!nock.isDone()) {
    console.error('æœªä½¿ç”¨ã®ãƒ¢ãƒƒã‚¯ãŒã‚ã‚Šã¾ã™')
    nock.cleanAll()
    throw new Error('æœªä½¿ç”¨ã®ãƒ¢ãƒƒã‚¯')
  }
})
```

### å®Ÿãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ç¦æ­¢

```javascript
beforeAll(() => {
  // ã™ã¹ã¦ã®å®Ÿãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç¦æ­¢
  nock.disableNetConnect()

  // localhost ã®ã¿è¨±å¯ï¼ˆãƒ†ã‚¹ãƒˆã‚µãƒ¼ãƒãƒ¼ç”¨ï¼‰
  nock.enableNetConnect('127.0.0.1')
})

afterAll(() => {
  nock.enableNetConnect()
})
```

### å…±é€šãƒ¢ãƒƒã‚¯ã®å†åˆ©ç”¨

```javascript
// mocks/userApi.js
const nock = require('nock')

function mockGetUser(id, data) {
  return nock('https://api.example.com')
    .get(`/users/${id}`)
    .reply(200, data)
}

function mockCreateUser(userData, responseData) {
  return nock('https://api.example.com')
    .post('/users', userData)
    .reply(201, responseData)
}

module.exports = { mockGetUser, mockCreateUser }
```

```javascript
// tests/user.test.js
const { mockGetUser } = require('../mocks/userApi')

test('ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—', async () => {
  mockGetUser('123', { id: '123', name: 'John' })

  // ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰...
})
```

## CI/CDçµ±åˆ

### GitHub Actionsè¨­å®šä¾‹

```yaml
name: Tests with Nock

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm ci

      - name: Run tests with Nock
        run: npm test
        env:
          NODE_ENV: test
```

## é–¢é€£ãƒ„ãƒ¼ãƒ«ãƒ»é€£æº

| ãƒ„ãƒ¼ãƒ« | ç”¨é€” | é€£æºæ–¹æ³• |
|--------|------|---------|
| **Jest** | ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | setupFilesè¨­å®š |
| **Mocha** | ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | before/after hooks |
| **Axios** | HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ | è‡ªå‹•ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆ |
| **node-fetch** | HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ | è‡ªå‹•ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆ |
| **Supertest** | APIãƒ†ã‚¹ãƒˆ | çµ„ã¿åˆã‚ã›ä½¿ç”¨ |
| **Faker.js** | ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ | ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ |

## ä»–ãƒ„ãƒ¼ãƒ«ã¨ã®æ¯”è¼ƒ

| æ©Ÿèƒ½ | Nock | MSW | WireMock | Sinon |
|------|------|-----|----------|-------|
| Node.jså¯¾å¿œ | âœ… | âœ… | âœ… | âœ… |
| ãƒ–ãƒ©ã‚¦ã‚¶å¯¾å¿œ | âŒ | âœ… | âŒ | âœ… |
| HTTPãƒ¢ãƒƒã‚¯ | âœ… å°‚ç”¨ | âœ… | âœ… | âš ï¸ æ±ç”¨ |
| è¨˜éŒ²ãƒ»å†ç”Ÿ | âœ… | âŒ | âœ… | âŒ |
| ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ | âŒ | âŒ | âœ… | âŒ |
| å­¦ç¿’æ›²ç·š | ä½ | ä¸­ | ä¸­ | ä¸­ |

## æ¨å¥¨ç”¨é€”

### æœ€é©ãªã‚±ãƒ¼ã‚¹

- Node.jsãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
- REST APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
- å¤–éƒ¨APIä¾å­˜ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
- CI/CDç’°å¢ƒã§ã®é«˜é€Ÿãƒ†ã‚¹ãƒˆ
- HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆè¨˜éŒ²ãƒ»å†ç”ŸãŒå¿…è¦

### ä¸å‘ããªã‚±ãƒ¼ã‚¹

- ãƒ–ãƒ©ã‚¦ã‚¶ãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆMSWæ¨å¥¨ï¼‰
- ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒãŒå¿…è¦ï¼ˆWireMockæ¨å¥¨ï¼‰
- GraphQLãƒ¡ã‚¤ãƒ³ã®ã‚¢ãƒ—ãƒªï¼ˆMSWæ¨å¥¨ï¼‰
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºç’°å¢ƒï¼ˆMSWæ¨å¥¨ï¼‰

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

**å•é¡Œ**: ãƒ¢ãƒƒã‚¯ãŒå‹•ä½œã—ãªã„

```javascript
// è§£æ±ºæ–¹æ³•: URLå®Œå…¨ä¸€è‡´ç¢ºèª
nock('https://api.example.com')  // æœ«å°¾ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ãªã—
  .get('/users')
  .reply(200, {})

// âœ… æ­£ã—ã„
await fetch('https://api.example.com/users')

// âŒ é–“é•ã„ï¼ˆæœ«å°¾ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ï¼‰
await fetch('https://api.example.com/users/')
```

**å•é¡Œ**: æœªä½¿ç”¨ã®ãƒ¢ãƒƒã‚¯è­¦å‘Š

```javascript
// è§£æ±ºæ–¹æ³•: persist()ã§è¤‡æ•°å›ä½¿ç”¨è¨±å¯
nock('https://api.example.com')
  .get('/resource')
  .reply(200, {})
  .persist()  // è¤‡æ•°å›å‘¼ã³å‡ºã—è¨±å¯
```

## å­¦ç¿’ãƒªã‚½ãƒ¼ã‚¹

| ãƒªã‚½ãƒ¼ã‚¹ | URL |
|---------|-----|
| **å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ** | [https://github.com/nock/nock](https://github.com/nock/nock) |
| **APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ** | [https://github.com/nock/nock#usage](https://github.com/nock/nock#usage) |
| **Examples** | [https://github.com/nock/nock/tree/main/tests](https://github.com/nock/nock/tree/main/tests) |

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [é–‹ç™ºå·¥ç¨‹_9_ãƒ†ã‚¹ãƒˆï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰](../../dev_process_é–‹ç™ºå·¥ç¨‹_9_ãƒ†ã‚¹ãƒˆ_ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³.md)
- [MSW (Mock Service Worker)](./MSW.md)
- [WireMock](./WireMock.md)
- [Jest](./Jest.md)
- [Mocha + Chai](./Mocha.md)

---

**æœ€çµ‚æ›´æ–°æ—¥**: 2025å¹´ï¼ˆä»¤å’Œ7å¹´ï¼‰
**æ–‡æ›¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0
