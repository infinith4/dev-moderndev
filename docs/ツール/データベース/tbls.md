# tbls

## 概要

tbls は、既存データベーススキーマからドキュメントと ER 図を自動生成する CLI ツールである。実DBを基に Markdown や図を生成できるため、設計書と実装の乖離を減らす運用に向いている。

## 料金

| プラン | 内容 |
|------|------|
| tbls | 無料（MIT License） |
| 商用利用 | ライセンス上可能（組織ポリシー確認は必要） |

## 主な特徴

| 項目 | 内容 |
|------|------|
| リバース生成 | 実DBからドキュメントを自動生成 |
| 多DB対応 | PostgreSQL/MySQL/SQLite 等に対応 |
| 図出力対応 | SVG/PNG/PlantUML/Mermaid へ出力 |
| CLI運用 | CI/CD へ組み込みやすい |
| 設定ファイル | `.tbls.yml` で出力方針を統一可能 |
| 軽量実行 | Go製で実行速度が速い |

## 主な機能

### ドキュメント生成機能

| 機能 | 説明 |
|------|------|
| スキーマ解析 | テーブル/カラム/制約を抽出 |
| Markdown出力 | テーブル定義を文書化 |
| コメント反映 | テーブル・カラム説明を付加 |
| 除外設定 | 管理不要テーブルを除外可能 |

### ER 図出力機能

| 機能 | 説明 |
|------|------|
| SVG/PNG | 画像として共有しやすい |
| PlantUML/Mermaid | テキスト管理しやすい |
| 関係距離調整 | 図の密度を調整可能 |
| フォーマット選択 | 用途別に出力形式を切替可能 |

### 運用自動化機能

| 機能 | 説明 |
|------|------|
| CLI実行 | バッチやCIジョブで実行可能 |
| Git連携 | 生成物を差分レビュー可能 |
| 定期更新 | スキーマ変更時に自動再生成 |
| チーム共有 | 常に最新設計書を配布しやすい |

## インストールとセットアップ

公式URL:
- [tbls GitHub](https://github.com/k1LoW/tbls)
- [Releases](https://github.com/k1LoW/tbls/releases)
- [公式ドキュメント](https://github.com/k1LoW/tbls#readme)

セットアップの要点:
1. Homebrew / バイナリ / Go install で tbls を導入する。
2. 接続先DSNを `.tbls.yml` に定義する。
3. 出力先ディレクトリと除外対象を設定する。
4. CI で定期生成し、ドキュメント更新を自動化する。

## 基本的な使い方

1. DB接続情報を指定して `tbls doc` を実行する。
2. 生成された `README.md` とテーブル定義を確認する。
3. `tbls out` で必要な図形式（SVG/Mermaid等）を出力する。
4. コメント設定を追加して可読性を改善する。
5. 変更をGit管理し、差分レビューで更新を確認する。

最小実行例:
- ドキュメント生成: `tbls doc postgres://user:pass@localhost:5432/app docs/db`
- 図生成: `tbls out -t svg postgres://user:pass@localhost:5432/app > schema.svg`

## メリット

- 実DBベースで設計書を自動生成し、乖離を減らしやすい。
- 複数形式で図を出力でき、共有用途に合わせやすい。
- CLI中心でCIに組み込みやすく、更新運用を自動化しやすい。

## デメリット

- GUI編集機能はなく、対話的モデリングには不向き。
- 接続先環境の整備（認証情報管理）が必要。
- 大規模スキーマでは出力図の可読性調整が必要。

## CI/CD での使用

DBマイグレーション後に `tbls doc` を実行し、生成物をコミットまたはアーティファクト保存する運用が有効である。スキーマ変更PRにドキュメント差分を含めると、レビュー精度を上げやすい。

## 他ツールとの比較

| ツール | 主な対象 | 特徴 |
|------|------|------|
| tbls | 既存DBの設計書自動生成 | 実DBからMarkdown/ER図を生成 |
| SchemaSpy | DBドキュメント生成 | JavaベースでHTML出力に強い |
| MySQL Workbench | DB設計GUI | 設計編集と管理を統合 |
| ERDPlus | 学習向けER設計 | 手動モデリングが中心 |

## ベストプラクティス

### 1. 設定ファイルを標準化

- `.tbls.yml` をリポジトリ管理する。
- コメント、除外対象、出力形式を固定する。

### 2. 生成タイミングを固定

- マイグレーション実行後に必ず再生成する。
- PRテンプレートに更新確認項目を追加する。

### 3. 図と文書を用途別に使い分け

- レビューは SVG、Wiki連携は Mermaid を使い分ける。
- 大規模スキーマはモジュール単位で分割出力する。

## 公式ドキュメント

- GitHub: https://github.com/k1LoW/tbls
- Releases: https://github.com/k1LoW/tbls/releases
- README: https://github.com/k1LoW/tbls#readme

## まとめ

- 実DBから設計書とER図を自動生成し、ドキュメント乖離を減らしやすい。
- CI連携で更新を継続運用すると、設計情報の鮮度を保ちやすい。
- 出力形式と更新ルールを決めることで、チーム共有を安定化しやすい。
