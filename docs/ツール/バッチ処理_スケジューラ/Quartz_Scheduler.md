# Quartz Scheduler

## 概要

Quartz Scheduler は Java 向けのジョブスケジューラライブラリである。定期実行、カレンダー制御、再実行制御などを行い、バッチや定期処理の実装を標準化しやすい。

## 料金

| 区分 | 内容 |
|------|------|
| Quartz 本体 | 無料（OSS） |
| 補足 | 実行基盤や監視運用コストは別途 |

## 主な特徴

| 項目 | 内容 |
|------|------|
| 柔軟なスケジュール | cron/間隔実行をサポート |
| Java 連携 | JVM アプリへ組み込みやすい |
| 永続化対応 | DB にジョブ状態を保持可能 |
| クラスタ実行 | 複数ノードで冗長運用可能 |
| 拡張性 | トリガー・リスナーで制御拡張 |

## 主な機能

### スケジューリング機能

| 機能 | 説明 |
|------|------|
| Simple Trigger | 固定間隔実行 |
| Cron Trigger | cron 式による柔軟実行 |
| Calendar 制御 | 実行除外日などを設定 |
| Misfire 制御 | 実行遅延時の挙動を定義 |

### 実行管理機能

| 機能 | 説明 |
|------|------|
| Job 定義 | 処理ロジックをジョブ化 |
| Trigger 分離 | 実行タイミングを分離管理 |
| Listener | 実行前後イベントを監視 |
| 再実行制御 | 失敗時ポリシーを定義 |

### 運用機能

| 機能 | 説明 |
|------|------|
| JDBC JobStore | 状態永続化と再起動耐性 |
| クラスタモード | 単一点障害を回避 |
| 監視連携 | ログ・メトリクス可視化 |
| ジョブ分離 | 高優先度ジョブを独立運用 |

## インストールとセットアップ

公式URL:
- [Quartz 公式](https://www.quartz-scheduler.org/)
- [Quartz Docs](https://www.quartz-scheduler.org/documentation/)

セットアップ手順:
1. 依存ライブラリを追加する。
2. スケジューラ設定（メモリ/DB）を決定する。
3. ジョブとトリガーを分離して定義する。

## 基本的な使い方

1. まず単一ジョブを固定間隔で実行して疎通確認する。
2. 次に cron トリガーへ移行して本番スケジュールを設定する。
3. 失敗時の再実行方針と通知を整備する。
4. 永続化が必要な処理は JDBC JobStore を利用する。

最小コマンド:
- 参考: アプリ起動時に Quartz Scheduler を初期化してジョブ登録

## メリット

- 定期処理を柔軟に制御できる
- Java アプリに統合しやすい
- 永続化・クラスタ対応で信頼性を高められる
- バッチ運用を標準化しやすい

## デメリット

- 設定項目が多く初期設計が必要
- ジョブ設計が不十分だと運用が複雑化する
- 単純用途にはオーバースペックになる場合がある

## 他ツールとの比較

| ツール | 主な用途 | 特徴 |
|------|------|------|
| Quartz Scheduler | Java 定期実行 | 柔軟・高機能なスケジュール制御 |
| Spring Scheduler | Java 定期実行 | Spring 内で簡易運用しやすい |
| Airflow | ワークフロー管理 | DAG ベースで依存処理に強い |
| Cron | OS 定期実行 | シンプルだがアプリ統合は弱い |

## ベストプラクティス

### 1. ジョブ責務を分離

- 1ジョブ1責務で設計する
- 長時間処理は分割・非同期化する

### 2. 失敗時方針を明確化

- リトライ回数と通知先を定義する
- 再実行による重複処理を防ぐ設計を行う

### 3. 監視を標準化

- 実行時間・失敗率を可視化する
- 遅延や未実行を早期検知する

## 公式ドキュメント

- 公式: https://www.quartz-scheduler.org/
- ドキュメント: https://www.quartz-scheduler.org/documentation/
- GitHub: https://github.com/quartz-scheduler/quartz

## まとめ

1. Quartz は Java の定期処理を柔軟に管理できる。
2. ジョブ設計と失敗時方針の明確化が運用安定に重要。
3. 監視連携まで含めて導入すると効果が高い。
