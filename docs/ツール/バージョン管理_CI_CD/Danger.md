# Danger

## 概要

Danger は、Pull Request のレビュー基準をコードで定義し、自動チェックするツールである。PRテンプレート未記入、変更サイズ超過、テスト欠落などのルールをCIで検査し、レビュー運用のばらつきを抑える。

## 料金

| プラン | 内容 |
|------|------|
| OSS 版 | 無料（MIT License） |
| 商用利用 | ライセンス上可能（組織ポリシー確認は必要） |

## 主な特徴

| 項目 | 内容 |
|------|------|
| ルール自動化 | PRレビュー手順をコード化可能 |
| CI連携 | GitHub Actions/GitLab CI等で実行可能 |
| PRコメント | ルール違反をPR上で通知 |
| 拡張性 | JavaScript/Ruby で条件を柔軟に記述 |
| 手続き統制 | レビュー必須項目の漏れを防止 |
| チーム標準化 | 共通レビュー基準を維持しやすい |

## 主な機能

### PRポリシー機能

| 機能 | 説明 |
|------|------|
| テンプレート検査 | PR説明の必須項目を検証 |
| 変更量検査 | 差分サイズ超過を通知 |
| ファイル検査 | 重要ファイル変更時に警告 |
| テスト有無検査 | テスト変更の有無を確認 |

### 通知機能

| 機能 | 説明 |
|------|------|
| fail/warn/message | 重要度別に通知出力 |
| PRコメント出力 | 違反理由をPR上へ表示 |
| ラベル連携 | 条件に応じてラベル操作 |
| レビュー補助 | レビュアー向け確認項目提示 |

### 運用機能

| 機能 | 説明 |
|------|------|
| Dangerfile管理 | ルールをリポジトリで版管理 |
| 例外制御 | 特定条件でチェック除外可能 |
| 多リポジトリ展開 | 共通ルールを横展開可能 |
| 継続改善 | 運用に応じてルール調整可能 |

## インストールとセットアップ

公式URL:
- [Danger 公式サイト](https://danger.systems/)
- [Danger JS](https://danger.systems/js/)
- [GitHub](https://github.com/danger/danger-js)

セットアップの要点:
1. Danger（JS/Ruby）をプロジェクトへ導入する。
2. `Dangerfile` を作成し、検査ルールを定義する。
3. CI ジョブで Danger 実行ステップを追加する。
4. fail/warn の使い分けをチームで合意する。

## 基本的な使い方

1. `Dangerfile` にPRルールを記述する。
2. PR作成時にCIで Danger を実行する。
3. ルール違反はPRコメントで確認する。
4. 必要に応じて修正または例外理由を記録する。
5. ルールを定期見直しして運用負荷を調整する。

最小実行例:
- ルール例: PR本文の `Checklist` 未記入で `fail`
- ルール例: 変更行数 > 1000 で `warn`

## メリット

- PRレビューの手順漏れを防止しやすい。
- ルールをコード化してチーム標準を維持しやすい。
- 人間レビューを本質的な設計確認へ集中しやすい。

## デメリット

- ルール過多だと開発体験を下げやすい。
- 初期設計が不十分だと誤警告が増えやすい。
- リポジトリごとの例外設計が必要になる。

## CI/CD での使用

CI のPRジョブに Danger を追加し、テンプレート確認や変更量チェックを自動化する。fail 条件を明確化すると、レビュー品質のばらつきを抑えやすい。

## 他ツールとの比較

| ツール | 主な対象 | 特徴 |
|------|------|------|
| Danger | PRルール自動化 | 手続きチェックの標準化に強い |
| Reviewdog | Lint結果コメント | 静的解析結果の通知に強い |
| CodeRabbit | AIレビュー支援 | 差分内容の自動指摘に強い |
| GitHub Actions | 汎用自動化 | ルール実行基盤として利用可能 |

## ベストプラクティス

### 1. fail条件を最小化

- まず必須ルールのみ fail に設定する。
- その他は warn で段階導入する。

### 2. ルールと目的を紐付け

- ルールごとに背景理由を明記する。
- 不要化したルールは定期削除する。

### 3. 例外運用を明文化

- 緊急対応時の例外手順を決める。
- 例外理由はPRコメントで残す。

## 公式ドキュメント

- 公式サイト: https://danger.systems/
- Danger JS: https://danger.systems/js/
- GitHub: https://github.com/danger/danger-js

## まとめ

1. **自動統制** : PR手続きルールを自動化し、レビュー品質を平準化しやすい。
2. **継続改善** : ルールコード化でチーム運用を継続的に改善しやすい。
3. **段階導入** : fail/warn の設計を段階的に整えると運用負荷を抑えやすい。
