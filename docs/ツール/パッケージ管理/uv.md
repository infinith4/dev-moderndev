# uv

## 概要

uv は Python 向けの高速なパッケージ管理・仮想環境管理ツールである。`pyproject.toml` と lockfile を中心に、依存解決、環境作成、ツール実行を一つの CLI で扱いやすい。

## 料金

| プラン | 内容 |
|------|------|
| uv 本体 | 無料（OSS） |
| PyPI 利用 | 公開パッケージの取得は無料（各サービス条件に依存） |
| 社内レジストリ連携 | 利用するレジストリ基盤の料金に依存 |

## 主な特徴

| 項目 | 内容 |
|------|------|
| 高速性 | 依存解決やインストールが高速で、CI 時間を短縮しやすい |
| 統合 CLI | 依存管理、仮想環境、ツール実行を一元化しやすい |
| lockfile 運用 | 依存バージョンの再現性を確保しやすい |
| Python 管理補助 | 実行環境の切替や固定を行いやすい |
| pip 互換運用 | 既存の Python ワークフローへ段階的に導入しやすい |
| CI/CD 適性 | キャッシュと組み合わせて高速な復元を実現しやすい |

## 主な機能

### 依存関係管理機能

| 機能 | 説明 |
|------|------|
| `uv add/remove` | 依存パッケージの追加・削除 |
| `uv lock` | 依存解決結果を lockfile に固定 |
| `uv sync` | lockfile に基づいて環境を同期 |
| 依存グループ管理 | 開発用途ごとに依存を分離しやすい |

### 環境/実行機能

| 機能 | 説明 |
|------|------|
| `uv venv` | 仮想環境の作成 |
| `uv run` | プロジェクト環境でコマンド実行 |
| Python バージョン指定 | 実行環境のバージョン統一を行いやすい |
| ツール実行 | テスト・lint などを環境差分なく実行しやすい |

### 運用/配布機能

| 機能 | 説明 |
|------|------|
| lockfile ベース運用 | 開発環境と CI の再現性を確保 |
| キャッシュ活用 | 依存取得の時間短縮 |
| インデックス設定 | 公開/社内レジストリを切替可能 |
| pip 連携 | 段階移行時に既存運用と併用しやすい |

## インストールとセットアップ

公式URL:
- [uv Documentation](https://docs.astral.sh/uv/)
- [uv GitHub](https://github.com/astral-sh/uv)
- [Astral](https://astral.sh/)

セットアップの要点:
1. 公式ドキュメントの手順で uv をインストールする。
2. プロジェクトに `pyproject.toml` を用意する。
3. `uv add` で依存を定義し、`uv lock` で固定する。
4. lockfile をコミットしてチームの再現性を確保する。

## 基本的な使い方

1. `uv add <package>` で依存を追加する。
2. `uv sync` で lockfile どおりに環境を同期する。
3. `uv run <command>` でテストや lint を実行する。
4. 依存更新時は `uv lock` を実行して差分を管理する。

最小運用例:
- 開発依存追加: `uv add --dev ruff pytest`
- CI: `uv sync && uv run pytest`

## メリット

- 依存導入が高速で、ローカル開発と CI の待ち時間を減らしやすい。
- 依存管理と実行環境管理を一つの CLI に統合しやすい。
- lockfile 運用でビルド再現性を高めやすい。
- 既存 Python プロジェクトへの段階導入がしやすい。

## デメリット

- チーム標準が Poetry/pip に固定されている場合は移行調整が必要。
- 既存 CI テンプレートのコマンド差し替えが発生する。
- 運用ルール（lock 更新手順、バージョン更新方針）の明文化が必要。

## CI/CD での使用

CI では `uv sync` を基本として lockfile どおりに依存を復元し、`uv run` でテストを実行する運用が有効である。キャッシュ戦略を併用すると、依存導入の時間短縮をさらに見込みやすい。

## 他ツールとの比較

| ツール | 強み | 特徴 |
|------|------|------|
| uv | 速度/統合性 | 依存管理と実行環境管理を高速に運用しやすい |
| Poetry | 統合管理 | 依存管理と公開ワークフローを整理しやすい |
| pip + venv | 標準構成 | 軽量で柔軟だが運用ルール整備が必要 |
| PDM | PEP 準拠 | `pyproject.toml` ベース運用に適合しやすい |

## ベストプラクティス

### 1. lockfile を基準に運用

- lockfile を必ずバージョン管理する。
- CI では `uv sync` を固定し、再現性を担保する。

### 2. 依存更新ルールを明確化

- 定期更新日を設定し、まとめて更新する。
- 重大脆弱性対応は通常更新と分離して扱う。

### 3. 実行コマンドを標準化

- テスト・lint・format の起動を `uv run` に統一する。
- 開発者ローカルと CI の実行手順を一致させる。

## 公式ドキュメント

- Docs: https://docs.astral.sh/uv/
- GitHub: https://github.com/astral-sh/uv
- Astral: https://astral.sh/

## まとめ

1. ** 性能改善 ** : uv は Python の依存管理と実行環境管理を高速化しやすい。
2. ** 自動運用 ** : lockfile と `uv sync` を軸にすると、開発環境と CI の再現性を維持しやすい。
3. ** 導入容易 ** : チーム運用ルールを先に定義すると、導入効果を安定して得やすい。

