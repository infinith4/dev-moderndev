# Diagrams (Python)

## 概要

Diagrams は、Python コードでアーキテクチャ図を生成できるオープンソースツールである。クラウドアイコンを使った構成図をコード化できるため、設計図をバージョン管理しながら継続的に更新しやすい。

## 料金

| プラン | 内容 |
|------|------|
| OSS 版 | 無料（MIT License） |
| 商用利用 | ライセンス上利用可能（組織ポリシー確認は必要） |

## 主な特徴

| 項目 | 内容 |
|------|------|
| コードベース作図 | Python で図を再現可能な形で定義 |
| クラウドアイコン対応 | AWS/Azure/GCP/Kubernetes の主要アイコンを利用可能 |
| 自動生成 | スクリプト実行で PNG/SVG/PDF を生成可能 |
| バージョン管理しやすい | 図の変更履歴を Git で追跡可能 |
| CI 連携 | ドキュメント更新時に図を自動再生成しやすい |
| 拡張性 | ループ・条件分岐で大規模構成図も管理しやすい |

## 主な機能

### 図生成機能

| 機能 | 説明 |
|------|------|
| Diagram コンテキスト | 図の出力設定と生成処理を定義 |
| ノード配置 | サービスやコンポーネントを定義 |
| エッジ接続 | 通信・依存関係を視覚化 |
| クラスタ | 機能単位・環境単位でグループ化 |

### アイコン/表現機能

| 機能 | 説明 |
|------|------|
| Provider アイコン | 各クラウドの公式系アイコン群を利用 |
| カスタムアイコン | 独自サービスを画像で追加 |
| ラベル/スタイル設定 | エッジやノードに属性を付与 |
| 出力形式切替 | `png` / `svg` / `pdf` へ切替可能 |

### 運用連携機能

| 機能 | 説明 |
|------|------|
| Git 管理 | 図の差分レビューを実施しやすい |
| CI 自動更新 | 変更時に図再生成を自動化 |
| ドキュメント統合 | MkDocs や Docusaurus へ画像埋め込み |
| 再現性 | 同じコードから同じ図を再生成可能 |

## インストールとセットアップ

公式URL:
- [Diagrams 公式サイト](https://diagrams.mingrammer.com/)
- [Installation](https://diagrams.mingrammer.com/docs/getting-started/installation)
- [Node Reference](https://diagrams.mingrammer.com/docs/nodes/aws)
- [GitHub](https://github.com/mingrammer/diagrams)

セットアップの要点:
1. Python 環境に `diagrams` をインストールする。
2. 依存として Graphviz を OS 側へ導入する。
3. 最小構成図を1本作成して出力確認する。
4. 図生成スクリプトを `docs/` 配下で管理する。

## 基本的な使い方

1. Python ファイルで Diagram とノードを定義する。
2. エッジで依存関係を接続する。
3. スクリプトを実行し、出力画像を生成する。
4. 生成画像を設計ドキュメントへ埋め込む。
5. 構成変更時はコード更新して再生成する。

最小運用例:
- 実行: `python architecture.py`
- 出力: `architecture.png`

## メリット

- 図をコード管理でき、設計変更に追従しやすい。
- クラウド構成図を統一フォーマットで作成しやすい。
- CI 連携で図の更新漏れを防ぎやすい。
- レビュー時に変更差分を確認しやすい。

## デメリット

- GUI 操作が前提のユーザーには学習コストがある。
- Graphviz 依存の環境セットアップが必要。
- 細かなレイアウト調整は制約が出やすい。

## CI/CD での使用

設計ドキュメント更新時に Diagrams スクリプトを CI で実行し、画像を自動生成する運用が有効である。これにより、実装変更と図の不一致を減らしやすい。

## 他ツールとの比較

| ツール | 主な用途 | 特徴 |
|------|------|------|
| Diagrams | コード生成型アーキ図 | Python で再現性高く管理しやすい |
| Mermaid | テキスト記法図 | 軽量で Markdown と相性が良い |
| PlantUML | テキスト記法図 | UML 表現に強い |
| draw.io | GUI 作図 | 直感操作だが差分管理は工夫が必要 |

## ベストプラクティス

### 1. 図をコードとして管理

- 図ファイルはソースコードと同じリポジトリで管理する。
- PR で図差分をレビュー対象に含める。

### 2. 命名規則を統一

- ノード名とクラスタ名を設計用語に合わせる。
- 環境（dev/stg/prod）ごとにファイル分割する。

### 3. 自動生成を標準化

- CI で図生成ジョブを固定化する。
- 生成物の保存先と更新手順を文書化する。

## 公式ドキュメント

- 公式サイト: https://diagrams.mingrammer.com/
- Installation: https://diagrams.mingrammer.com/docs/getting-started/installation
- Docs: https://diagrams.mingrammer.com/docs/getting-started/examples
- GitHub: https://github.com/mingrammer/diagrams

## まとめ

1. ** 設計品質 ** : Diagrams は構成図をコード管理し、設計変更へ追従しやすい。
2. ** 再現性 ** : Graphviz と組み合わせることで再現可能な図生成を実現しやすい。
3. ** 自動運用 ** : CI で自動生成を組み込むと、ドキュメント品質を維持しやすい。

