# Moq

## 概要
Moq は .NET 向けのモックライブラリです。インターフェースや仮想メソッドの依存を置き換えて、単体テストでの契約検証を行えます。

## 料金
| プラン | 料金 | 備考 |
|---|---:|---|
| OSS | 無料 | .NET テストで広く利用 |

## 主な特徴
| 特徴 | 内容 |
|---|---|
| モック作成 | 依存オブジェクトを簡潔に定義できる |
| 検証機能 | 呼び出し回数や引数を確認できる |
| .NET 連携 | xUnit/NUnit/MSTest と併用しやすい |

## 主な機能

### コア機能

| 機能 | 用途 | 実務での使いどころ |
|---|---|---|
| 依存分離 | 外部接続を遮断 | サービス層の単体検証 |
| 振る舞い設定 | 返却値・例外の制御 | 異常系試験 |
| 呼び出し検証 | 契約確認 | 設計意図の担保 |

### 連携機能

| 機能 | 説明 |
|------|------|
| ツール連携 | 既存の開発・運用ツールと連携しやすい |
| 自動実行 | ローカル実行と CI 実行の両方に対応しやすい |

### 運用機能

| 機能 | 説明 |
|------|------|
| 結果管理 | 実行結果を蓄積して比較しやすい |
| 変更追跡 | 設定変更の影響を確認しやすい |

## インストールとセットアップ

公式URL:
- [公式リンク1](https://github.com/moq/moq)

セットアップ手順:
1. .NET テスト基盤と組み合わせ方針を決めます。
2. モック対象となる依存の抽象化を整理します。
3. テスト規約（命名、検証粒度）を統一します。

## 基本的な使い方
1. 対象クラスの依存をモックに差し替えます。
2. 期待する戻り値や例外を設定します。
3. 実行後に結果と呼び出し契約を確認します。

最小実行例:
- ローカル環境で Moq の基本機能を実行
- CI で定期実行し、結果を比較

## メリット
| 観点 | 内容 |
|---|---|
| 再現性 | 外部要因を除いた検証が可能 |
| 生産性 | テストケース作成を効率化 |
| 品質 | 設計契約の逸脱を検知しやすい |

## デメリット
| 観点 | 内容 |
|---|---|
| 複雑度 | モック設定が増えると可読性低下 |
| 設計依存 | 抽象化不足だと適用しづらい |
| 過検証 | 実装詳細に依存した脆いテストになりやすい |

## 他ツールとの比較
| ツール | 強み | 使い分け |
|---|---|---|
| Moq | .NET で普及し情報が豊富 | 標準的なモック運用 |
| NSubstitute | 記述が直感的 | シンプルなテスト志向 |
| FakeItEasy | 学習しやすい API | 小中規模開発 |

## ベストプラクティス

### 1. モックは外部依存境界に限定して使用します

- モックは外部依存境界に限定して使用します。
- 判断基準を文書化してチームで共有する。

### 2. 呼び出し回数より業務結果の検証を優先します

- 呼び出し回数より業務結果の検証を優先します。
- 変更時は影響範囲を確認してから反映する。

### 3. テスト失敗時に意図が読める命名を徹底します

- テスト失敗時に意図が読める命名を徹底します。
- 定期レビューで運用改善を継続する。

## 公式ドキュメント
- https://github.com/moq/moq

## まとめ

1. ** 検証効率 ** : Moq は .NET 単体テストで依存分離と契約検証を行う定番選択肢です。
2. ** 標準化 ** : 効果を高めるには、抽象化設計と検証粒度の統一が必要です。
3. ** 設計品質 ** : 過剰なモック利用を避け、実装に強く依存しないテスト設計を維持します。

