# unittest.mock

## 概要
unittest.mock は Python 標準ライブラリのモック機能です。外部依存を置き換えて、単体テストでの振る舞い検証を安定化できます。

## 料金
| プラン | 料金 | 備考 |
|---|---:|---|
| 標準機能 | 無料 | Python に同梱 |

## 主な特徴
| 特徴 | 内容 |
|---|---|
| 標準搭載 | 追加依存なしで利用可能 |
| 柔軟な差し替え | 関数・メソッド・オブジェクトを置換可能 |
| 検証機能 | 呼び出し回数・引数を確認可能 |

## 主な機能
| 機能 | 用途 | 実務での使いどころ |
|---|---|---|
| patch | 依存の差し替え | 外部 API/時刻/ファイル I/O の隔離 |
| Mock/ MagicMock | 振る舞い定義 | 異常系・分岐制御 |
| assert 系 | 呼び出し契約検証 | 設計意図の担保 |

## インストールとセットアップ
1. テスト方針でモック利用基準を決めます。
2. 外部依存箇所を明確化し、抽象化方針を整理します。
3. テスト失敗時の調査手順を標準化します。

## 基本的な使い方
1. 外部依存を置き換える対象を特定します。
2. 戻り値や副作用をテスト目的に合わせて設定します。
3. 実行後に期待結果と呼び出し契約を確認します。

## メリット
| 観点 | 内容 |
|---|---|
| 導入性 | 標準機能で即利用できる |
| 再現性 | 非決定要素を排除しやすい |
| 保守性 | 依存境界を明確にできる |

## デメリット
| 観点 | 内容 |
|---|---|
| 可読性 | patch 乱用で意図が分かりにくくなる |
| 脆さ | 実装詳細依存のテストになりやすい |
| 設計依存 | 依存分離されていないコードには適用しづらい |

## 他ツールとの比較
| ツール | 強み | 使い分け |
|---|---|---|
| unittest.mock | 標準機能で安定利用 | 依存追加を避けたい場合 |
| pytest-mock | pytest 連携が容易 | pytest 中心運用 |
| responses | HTTP モック特化 | API 通信の再現 |

## ベストプラクティス
1. モック対象は外部境界に限定して過剰利用を避けます。
2. 呼び出し詳細より業務結果の検証を優先します。
3. patch 範囲を最小化し、テストの独立性を保ちます。

## 公式ドキュメント
- https://docs.python.org/3/library/unittest.mock.html

## まとめ

1. ** 標準搭載 ** : unittest.mock は Python 標準で依存分離テストを実現できる有効な手段です。
2. ** 境界設計 ** : 効果を高めるには、境界設計とモック粒度の統一が必要です。
3. ** 保守性 ** : 実装詳細に依存しすぎない検証設計が長期保守に有利です。

