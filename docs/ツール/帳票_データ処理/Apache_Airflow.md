# Apache Airflow

## 概要
Apache Airflow は、ワークフローを DAG（依存関係付きタスク）として管理し、定期実行と監視を行うオーケストレーションツールです。データパイプラインやバッチ処理の運用標準化に適しています。

## 料金
| プラン | 料金 | 備考 |
|---|---:|---|
| OSS | 無料 | 自前で基盤構築・運用が必要 |
| マネージドサービス | 有料 | 例: Amazon MWAA、Cloud Composer |

## 主な特徴
| 特徴 | 内容 |
|---|---|
| DAG 管理 | タスク依存関係を可視化して管理できる |
| スケジューリング | 時刻・間隔・イベントで自動実行できる |
| 運用監視 | 実行履歴、失敗、再実行を UI で追跡できる |

## 主な機能

### コア機能

| 機能 | 用途 | 実務での使いどころ |
|---|---|---|
| ワークフロー実行 | バッチ処理の自動化 | 夜間集計や連携ジョブ |
| リトライ制御 | 障害時の復旧性向上 | 一時障害の自動回復 |
| 実行ログ管理 | 原因分析の効率化 | 障害調査と監査対応 |

### 連携機能

| 機能 | 説明 |
|------|------|
| ツール連携 | 既存の開発・運用ツールと連携しやすい |
| 自動実行 | ローカル実行と CI 実行の両方に対応しやすい |

### 運用機能

| 機能 | 説明 |
|------|------|
| 結果管理 | 実行結果を蓄積して比較しやすい |
| 変更追跡 | 設定変更の影響を確認しやすい |

## インストールとセットアップ

公式URL:
- [公式リンク1](https://airflow.apache.org/)
- [公式リンク2](https://airflow.apache.org/docs/)

セットアップ手順:
1. 実行基盤（Docker/Kubernetes/VM）を決定します。
2. メタデータ DB、実行ワーカー、スケジューラ構成を準備します。
3. 接続先情報と運用ルール（通知、再実行、権限）を設定します。

## 基本的な使い方
1. 処理手順をタスク分割し、依存関係を定義します。
2. 実行スケジュールと失敗時ポリシーを設定します。
3. 運用では実行履歴を確認し、失敗ジョブを再実行します。

最小実行例:
- ローカル環境で Apache Airflow の基本機能を実行
- CI で定期実行し、結果を比較

## メリット
| 観点 | 内容 |
|---|---|
| 可視化 | ジョブ依存関係と実行状態を把握しやすい |
| 再現性 | 同一ワークフローを継続実行しやすい |
| 拡張性 | データ基盤やクラウドサービスと連携しやすい |

## デメリット
| 観点 | 内容 |
|---|---|
| 運用負荷 | OSS は基盤保守と監視設計が必要 |
| 学習コスト | DAG 設計と運用ルールの習熟が必要 |
| 過剰設計 | 小規模処理では構成が重くなりやすい |

## 他ツールとの比較
| ツール | 強み | 使い分け |
|---|---|---|
| Airflow | ワークフロー制御と監視に強い | 複数ジョブを統合管理したい場合 |
| Apache NiFi | フローベースでリアルタイム連携に強い | データ流通制御中心の場合 |
| dbt Core | SQL 変換とモデル管理に強い | DWH 変換ロジック中心の場合 |

## ベストプラクティス
1. DAG を業務単位で分割し、依存を最小化します。
2. 再実行可能な冪等処理を前提に設計します。
3. SLA 指標（遅延、失敗率）を定義して監視に反映します。

## 公式ドキュメント
- https://airflow.apache.org/
- https://airflow.apache.org/docs/

## まとめ

1. ** 統合管理 ** : Airflow は定期バッチと依存関係のある処理を安定運用するための中核ツールです。
2. ** 障害対策 ** : 効果を出すには DAG 設計だけでなく、障害時運用と監視設計が重要です。
3. ** 拡張性 ** : 小さく導入し、運用指標を定義しながら段階的に拡張する運用が実践的です。

