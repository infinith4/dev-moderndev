# dbt Core

## 概要
dbt Core は、SQL ベースでデータ変換処理をモデリングし、テストとドキュメント管理を行うデータ変換ツールです。DWH 上の変換ロジックをコード管理しやすくします。

## 料金
| プラン | 料金 | 備考 |
|---|---:|---|
| dbt Core | 無料 | OSS、自己運用 |
| dbt Cloud | 有料 | ジョブ実行、監視、権限管理を提供 |

## 主な特徴
| 特徴 | 内容 |
|---|---|
| SQL 中心 | 分析基盤チームが扱いやすい |
| 依存関係管理 | モデル間依存を明確化できる |
| 品質管理 | テストで変換品質を自動検証できる |

## 主な機能

### コア機能

| 機能 | 用途 | 実務での使いどころ |
|---|---|---|
| モデル管理 | 変換ロジックの分割管理 | DWH 整備の標準化 |
| データテスト | 一意性・NULL・参照整合確認 | 品質ゲート設定 |
| ドキュメント生成 | 依存関係の可視化 | 引き継ぎ・監査対応 |

### 連携機能

| 機能 | 説明 |
|------|------|
| ツール連携 | 既存の開発・運用ツールと連携しやすい |
| 自動実行 | ローカル実行と CI 実行の両方に対応しやすい |

### 運用機能

| 機能 | 説明 |
|------|------|
| 結果管理 | 実行結果を蓄積して比較しやすい |
| 変更追跡 | 設定変更の影響を確認しやすい |

## インストールとセットアップ

公式URL:
- [公式リンク1](https://docs.getdbt.com/)
- [公式リンク2](https://github.com/dbt-labs/dbt-core)

セットアップ手順:
1. 対応 DWH と接続情報を準備します。
2. プロジェクト構成、命名規約、環境分離方針を決めます。
3. 主要モデルから段階導入し、テストを必須化します。

## 基本的な使い方
1. 変換処理をモデル単位に分割して定義します。
2. モデルテストを実行し、品質要件を満たすか確認します。
3. 依存関係ドキュメントで影響範囲を確認しながら変更を反映します。

最小実行例:
- ローカル環境で dbt Core の基本機能を実行
- CI で定期実行し、結果を比較

## メリット
| 観点 | 内容 |
|---|---|
| 保守性 | SQL 変換ロジックを構造化しやすい |
| 品質 | テストを組み込んで不整合を早期検知できる |
| 可視化 | 依存関係が共有しやすい |

## デメリット
| 観点 | 内容 |
|---|---|
| 前提 | DWH 設計と SQL 品質に依存する |
| 運用 | モデル増加時に規約管理が重要になる |
| 役割分担 | オーケストレーションは別ツール連携が必要 |

## 他ツールとの比較
| ツール | 強み | 使い分け |
|---|---|---|
| dbt Core | SQL 変換と品質テストに強い | DWH 変換標準化 |
| Airflow | 実行制御と依存管理に強い | 複数システムのジョブ統合 |
| NiFi | データ流通制御に強い | 収集・配送中心の連携 |

## ベストプラクティス
1. レイヤー構造（staging/intermediate/mart）を固定して設計します。
2. 重要モデルは必須テストを定義し、レビューで担保します。
3. 変更時は依存影響を確認して段階リリースします。

## 公式ドキュメント
- https://docs.getdbt.com/
- https://github.com/dbt-labs/dbt-core

## まとめ

1. ** 保守性 ** : dbt Core は DWH の変換ロジックを保守可能な形で管理するための有効な選択肢です。
2. ** 運用性 ** : 成果を出すには、モデル規約とテスト運用をセットで設計することが重要です。
3. ** 情報共有 ** : Airflow などと連携すると、変換品質と実行自動化を両立できます。

