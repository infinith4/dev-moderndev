# k6

## 概要
k6 は、JavaScript で性能テストを記述し、API や Web サービスの負荷特性を検証できるツールである。開発フローに組み込みやすく、CI 主体の継続運用に向いている。

## 料金

| 区分 | 内容 |
|------|------|
| OSS | 無料（自己運用） |
| k6 Cloud | 有料（大規模実行・可視化を拡張） |

## 主な特徴

| 項目 | 内容 |
|------|------|
| JavaScript 記述 | 開発者が扱いやすい |
| 自動化適性 | CI/CD に統合しやすい |
| 閾値判定 | SLO/SLA を明確に判定しやすい |
| 実行速度 | 反復試験を回しやすい |
| 開発親和性 | テスト資産をコードとして保守しやすい |

## 主な機能

### 負荷試験機能

| 機能 | 説明 |
|------|------|
| 負荷モデル設定 | 一定負荷・段階負荷・スパイクを定義 |
| 仮想ユーザー実行 | 想定トラフィックを再現 |
| シナリオ制御 | API 利用フローを継続的に検証 |

### 判定機能

| 機能 | 説明 |
|------|------|
| 閾値定義 | p95、失敗率、TPS で合否判定 |
| 自動ゲート | 閾値超過時に失敗判定を返す |
| 回帰検知 | 変更前後の性能差分を確認 |

### 運用機能

| 機能 | 説明 |
|------|------|
| CLI 実行 | ローカル/CI で同一手順を実行 |
| 結果出力 | 指標を可視化して比較分析 |
| 継続運用連携 | パイプラインに組み込んで定期検証 |

## インストールとセットアップ

公式URL:
- [k6 公式ドキュメント](https://grafana.com/docs/k6/latest/)
- [k6 GitHub](https://github.com/grafana/k6)

セットアップ手順:
1. k6 実行環境とテスト対象情報を準備する。
2. 認証、テストデータ、負荷パターンを定義する。
3. 指標（p95、失敗率、TPS）と閾値を設定する。

## 基本的な使い方
1. 想定トラフィックをシナリオに反映する。
2. 試験を実行し、遅延・失敗率・スループットを確認する。
3. 閾値超過時に原因を分析して改善する。
4. 同条件で再試験し、改善結果を比較する。

最小実行例:
- ローカルで負荷試験を実行
- CI で閾値判定を自動化

## メリット

- JavaScript ベースで開発チームが運用しやすい
- 閾値判定で合否を機械的に判断しやすい
- CLI 実行で CI/CD へ統合しやすい
- 継続比較で性能劣化を追跡しやすい

## デメリット

- シナリオ設計の品質が結果妥当性を左右する
- 実行環境差異で結果がぶれる場合がある
- OSS 単体では可視化設計を追加することがある

## 他ツールとの比較

| ツール | 主な用途 | 特徴 |
|------|------|------|
| k6 | CI 主体性能試験 | JS 記述と閾値判定で自動化しやすい |
| JMeter | GUI 性能試験 | 導入しやすく実績が豊富 |
| Gatling | 高負荷性能試験 | 再現性と分析に強い |
| Locust | Python 記述試験 | 業務シナリオを柔軟に表現可能 |

## ベストプラクティス

### 1. 指標管理を先に設計

- 目標指標と閾値を先に固定する
- テストコードと判定基準を分離して管理する

### 2. 負荷を段階的に拡張

- 小規模試験から本番想定へ拡張する
- 異常発生点で原因を切り分ける

### 3. 結果比較を継続運用

- 試験結果を時系列で蓄積する
- 劣化傾向を定点観測して早期に対応する

## 公式ドキュメント

- 公式: https://grafana.com/docs/k6/latest/
- GitHub: https://github.com/grafana/k6

## まとめ

1. **自動化** : k6 は開発フローに組み込みやすく継続運用に向く。
2. **判定性** : 閾値管理を明確化すると性能品質を安定して判断できる。
3. **継続性** : 結果の時系列比較で性能劣化を早期に検知しやすい。
