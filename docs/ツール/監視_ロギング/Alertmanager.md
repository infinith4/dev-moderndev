# Alertmanager

## 概要

Alertmanager は Prometheus のアラート通知を集約・ルーティングするためのツールである。重複抑制、グルーピング、通知先振り分けにより、運用通知のノイズを減らしやすい。

## 料金

| 区分 | 内容 |
|------|------|
| Alertmanager 本体 | 無料（OSS） |
| 補足 | 通知先サービス利用料は別途 |

## 主な特徴

| 項目 | 内容 |
|------|------|
| 通知集約 | 複数アラートをまとめて処理 |
| ノイズ抑制 | 重複通知や連続通知を制御 |
| ルーティング | 重要度・サービス別に通知先を分離 |
| 柔軟設定 | 受信者、時間帯、条件の制御が可能 |
| Prometheus 連携 | 監視基盤と自然に統合可能 |

## 主な機能

### 通知制御機能

| 機能 | 説明 |
|------|------|
| Grouping | 類似アラートをまとめて通知 |
| Deduplication | 重複通知を抑制 |
| Silencing | メンテナンス時に一時抑止 |
| Inhibition | 上位障害時に下位通知を抑止 |

### ルーティング機能

| 機能 | 説明 |
|------|------|
| 受信者振り分け | チーム/サービス別に通知先を分離 |
| 重要度別通知 | Severity に応じて通知先を切替 |
| 時間帯制御 | オンコール時間に応じた通知制御 |
| 再通知設定 | 未対応時の再通知間隔を設定 |

### 運用機能

| 機能 | 説明 |
|------|------|
| Web UI | サイレンスと通知状態を確認 |
| HA 構成 | 複数ノードで冗長運用 |
| 監査性 | 通知設定をコード管理可能 |
| 連携拡張 | Slack、PagerDuty、Email などに対応 |

## インストールとセットアップ

公式URL:
- [Alertmanager 公式](https://prometheus.io/docs/alerting/latest/alertmanager/)
- [Prometheus Docs](https://prometheus.io/docs/)

セットアップ手順:
1. Alertmanager を導入し基本設定ファイルを作成する。
2. 通知先（メール/チャット/オンコール）を登録する。
3. 重大度別ルーティングを定義する。
4. サイレンス運用手順をチーム標準化する。

## 基本的な使い方

1. まず重大アラートだけ通知する最小設定で開始する。
2. ノイズが多いアラートは grouping と inhibition で調整する。
3. メンテナンス時は事前にサイレンスを登録する。
4. 運用後に通知遅延や見逃しをレビューして設定を改善する。

## メリット

- 通知ノイズを減らし対応集中しやすい
- 重大度別の通知設計がしやすい
- Prometheus との統合が容易
- 設定をコード管理しやすい

## デメリット

- 初期ルーティング設計に時間がかかる
- 設定ミスで通知漏れのリスクがある
- オンコール運用ルールが未整備だと効果が出にくい

## 他ツールとの比較

| ツール | 主な用途 | 特徴 |
|------|------|------|
| Alertmanager | アラート集約/通知制御 | Prometheus 連携とノイズ抑制に強い |
| PagerDuty | インシデント通知 | オンコール運用に特化 |
| Opsgenie | 通知管理 | 通知ポリシー管理が豊富 |
| Grafana Alerting | 監視通知 | 可視化基盤と一体運用しやすい |

## ベストプラクティス

### 1. 重大度を先に定義

- P1/P2 など運用優先度を統一する
- 重大度に応じた通知先を明確化する

### 2. サイレンス運用を定着

- メンテ前後でサイレンス管理を徹底する
- 無期限サイレンスを避ける

### 3. 通知品質を継続改善

- ノイズ率と見逃し率を定期確認する
- 実インシデント後に設定を見直す

## 公式ドキュメント

- 公式: https://prometheus.io/docs/alerting/latest/alertmanager/
- Prometheus Docs: https://prometheus.io/docs/
- GitHub: https://github.com/prometheus/alertmanager

## まとめ

1. ** 通知制御 ** : Alertmanager は通知ノイズ削減に有効な基盤です。
2. ** 設計重要 ** : 重大度とルーティング設計が運用品質を左右します。
3. ** 継続改善 ** : サイレンス運用と継続的見直しが必須です。
