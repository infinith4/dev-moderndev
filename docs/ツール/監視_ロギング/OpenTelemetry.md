# OpenTelemetry

## 概要

OpenTelemetry はメトリクス、ログ、トレースのテレメトリ収集を標準化する OSS 仕様・実装である。ベンダー依存を抑えながらオブザーバビリティ基盤を設計しやすい。

## 料金

| 区分 | 内容 |
|------|------|
| OpenTelemetry 本体 | 無料（OSS） |
| 補足 | 送信先バックエンド（APM/監視基盤）の費用は別途 |

## 主な特徴

| 項目 | 内容 |
|------|------|
| ベンダーニュートラル | 複数バックエンドへ接続可能 |
| 標準化 | 収集方式を統一しやすい |
| 多言語対応 | 主要言語 SDK を提供 |
| 拡張性 | Collector で処理・ルーティング可能 |
| 将来性 | CNCF 主導でエコシステムが広い |

## 主な機能

### 収集機能

| 機能 | 説明 |
|------|------|
| トレース収集 | 分散トレース情報を取得 |
| メトリクス収集 | アプリ/基盤指標を取得 |
| ログ収集連携 | ログとトレースの相関を構築 |
| コンテキスト伝播 | サービス間追跡を維持 |

### Collector 機能

| 機能 | 説明 |
|------|------|
| 受信/変換/送信 | テレメトリ処理パイプラインを構成 |
| フィルタ/サンプリング | データ量を制御 |
| ルーティング | 宛先ごとに送信分岐 |
| バッファ制御 | 負荷変動時の安定送信を補助 |

### 運用機能

| 機能 | 説明 |
|------|------|
| 設定コード管理 | 収集設定をバージョン管理可能 |
| 監査性 | 収集ポリシーの追跡が容易 |
| バックエンド切替 | 送信先変更の柔軟性が高い |
| コスト最適化 | サンプリングでデータ量を制御 |

## インストールとセットアップ

公式URL:
- [OpenTelemetry 公式](https://opentelemetry.io/)
- [OpenTelemetry Docs](https://opentelemetry.io/docs/)

セットアップ手順:
1. 監視対象サービスと言語を整理する。
2. SDK 導入方針（自動計装/手動計装）を決める。
3. Collector を配置し送信先を定義する。
4. サンプリング・保持方針を運用要件に合わせる。

## 基本的な使い方

1. まず主要サービスにトレース計装を導入する。
2. 次にメトリクス・ログ連携を追加して相関調査を可能にする。
3. データ量とコストを見ながらサンプリングを調整する。
4. 定期的に収集品質と欠損率を見直す。

## メリット

- 観測データ収集の標準化が可能
- ベンダーロックインを抑えやすい
- 多言語/多環境へ展開しやすい
- 将来の送信先変更に対応しやすい

## デメリット

- 初期設計が不十分だと運用が複雑化する
- 計装範囲拡大時に調整コストがかかる
- バックエンド選定と組み合わせ検証が必要

## 他ツールとの比較

| ツール | 主な用途 | 特徴 |
|------|------|------|
| OpenTelemetry | テレメトリ標準収集 | ベンダーニュートラルで拡張しやすい |
| Datadog Agent | 収集エージェント | Datadog 連携最適化 |
| New Relic Agent | APM 収集 | New Relic 連携に最適 |
| Prometheus Exporters | メトリクス収集 | メトリクス特化でシンプル |

## ベストプラクティス

### 1. 計装方針を標準化

- サービスごとの必須属性を定義する
- 自動計装と手動計装の境界を決める

### 2. Collector を中心設計

- 変換・ルーティングを Collector 側で統一する
- アプリ側に複雑処理を持たせない

### 3. コスト制御を組み込む

- サンプリングと保持方針を明確化する
- 高負荷時のデータ制御を事前設計する

## 公式ドキュメント

- 公式サイト: https://opentelemetry.io/
- ドキュメント: https://opentelemetry.io/docs/
- GitHub: https://github.com/open-telemetry

## まとめ

1. **標準化** : OpenTelemetry は観測収集の標準化に有効です。
2. **設計方針** : Collector 中心の設計で運用負荷を抑えやすいです。
3. **費用管理** : サンプリング設計でコストと品質を両立します。
