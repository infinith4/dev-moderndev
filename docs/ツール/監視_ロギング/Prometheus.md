# Prometheus

## 概要

Prometheus は時系列メトリクス収集とアラートを担う OSS 監視基盤である。クラウドネイティブ環境で広く利用され、可観測性基盤の中心として採用されることが多い。

## 料金

| 区分 | 内容 |
|------|------|
| Prometheus 本体 | 無料（OSS） |
| 補足 | 保存ストレージ・運用基盤コストは別途 |

## 主な特徴

| 項目 | 内容 |
|------|------|
| Pull 収集モデル | 監視対象から定期スクレイプ |
| PromQL | 柔軟な時系列クエリが可能 |
| アラート連携 | Alertmanager と統合運用可能 |
| CNCF 標準 | Kubernetes 監視との親和性が高い |
| 拡張性 | Exporter で対象を広くカバー |

## 主な機能

### 収集機能

| 機能 | 説明 |
|------|------|
| メトリクス取得 | Exporter 経由で各種指標収集 |
| Service Discovery | 動的環境の対象発見 |
| ラベル管理 | 次元別分析を可能にする |
| 保持設定 | 保存期間と容量を制御 |

### 分析・通知機能

| 機能 | 説明 |
|------|------|
| PromQL 分析 | 時系列データを柔軟に集計 |
| Recording Rules | クエリ結果を事前計算 |
| Alert Rules | 閾値条件で通知生成 |
| Alertmanager 連携 | 通知集約とルーティングを実現 |

### 運用機能

| 機能 | 説明 |
|------|------|
| Federation | 複数 Prometheus 統合 |
| リモート書き込み | 長期保存基盤へ連携可能 |
| 監視対象拡張 | Exporter 追加で対象拡張 |
| 監視基盤監視 | Prometheus 自体の健全性監視 |

## インストールとセットアップ

公式URL:
- [Prometheus 公式](https://prometheus.io/)
- [Prometheus Docs](https://prometheus.io/docs/)

セットアップ手順:
1. Prometheus を導入し基本スクレイプ設定を定義する。
2. 主要対象の Exporter を配置する。
3. 重要KPIの Recording/Alert ルールを設定する。
4. Alertmanager と Grafana を連携して運用導線を整備する。

## 基本的な使い方

1. まずインフラ基本指標（CPU、メモリ、ディスク）を収集する。
2. 次にアプリ指標を追加してサービス観測を拡張する。
3. アラートは重大度を分けて段階導入する。
4. 定期的にルールと保持設定を見直す。

## メリット

- OSS で強力な監視基盤を構築できる
- Kubernetes 環境との親和性が高い
- PromQL で柔軟分析ができる
- Exporter で適用対象を広げやすい

## デメリット

- 長期保存は追加設計が必要
- ラベル設計を誤ると運用負荷が増える
- 大規模運用では構成設計が重要

## 他ツールとの比較

| ツール | 主な用途 | 特徴 |
|------|------|------|
| Prometheus | メトリクス監視基盤 | OSS と柔軟クエリが強み |
| Datadog | 統合監視SaaS | 導入容易で商用機能が豊富 |
| CloudWatch | AWS 監視 | AWS ネイティブ統合が強い |
| Zabbix | 監視基盤 | サーバー監視運用実績が豊富 |

## ベストプラクティス

### 1. ラベル設計を最適化

- 必要最小限のラベルに絞る
- 高カーディナリティを避ける

### 2. ルールを段階導入

- 重大アラートから先に適用する
- ノイズアラートを定期削減する

### 3. 長期運用を設計

- 保持期間とストレージを計画する
- 長期分析はリモート保存を検討する

## 公式ドキュメント

- 公式サイト: https://prometheus.io/
- ドキュメント: https://prometheus.io/docs/
- GitHub: https://github.com/prometheus/prometheus

## まとめ

1. **監視基盤** : Prometheus は OSS メトリクス監視の中核基盤です。
2. **設計重要** : ラベル・ルール設計で運用品質が大きく変わります。
3. **長期運用** : 長期保存を含む構成設計が継続運用の鍵です。
