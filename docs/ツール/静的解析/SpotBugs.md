# SpotBugs

## 概要

SpotBugs は Java バイトコードを解析して不具合パターンを検出する静的解析ツールである。NullPointer や誤実装につながる典型問題を早期に見つけ、品質事故の予防に役立つ。

## 料金

| 区分 | 内容 |
|------|------|
| SpotBugs 本体 | 無料（OSS） |
| 補足 | 実行基盤や CI コストは別途 |

## 主な特徴

| 項目 | 内容 |
|------|------|
| バグ検出特化 | コーディング規約より不具合検出を重視 |
| バイトコード解析 | ソースだけでは見えない問題も検出可能 |
| Maven/Gradle 連携 | ビルド工程に組み込みやすい |
| ルール拡張 | プラグインで検出観点を追加可能 |
| 実績 | Java 品質改善で長期利用実績 |

## 主な機能

### 解析機能

| 機能 | 説明 |
|------|------|
| 不具合パターン検出 | NPE、無限再帰、誤比較などを検知 |
| 重大度分類 | 優先対応すべき警告を識別 |
| クラス単位解析 | 影響範囲の切り分けが可能 |
| Filter 設定 | 誤検知を抑える調整が可能 |

### 連携機能

| 機能 | 説明 |
|------|------|
| Maven プラグイン | `verify` 工程で実行可能 |
| Gradle プラグイン | build パイプラインへ統合 |
| レポート出力 | XML/HTML などで結果共有 |
| CI 連携 | 品質ゲートとして利用可能 |

### 品質運用機能

| 機能 | 説明 |
|------|------|
| 回帰防止 | 既知問題の再混入を防止 |
| 優先対応 | 重大度順で改善計画を立てやすい |
| 可視化 | 継続的に品質傾向を確認 |
| 他解析併用 | Checkstyle/PMD と補完可能 |

## インストールとセットアップ

公式URL:
- [SpotBugs 公式](https://spotbugs.github.io/)
- [SpotBugs GitHub](https://github.com/spotbugs/spotbugs)

セットアップ手順:
1. Maven または Gradle プラグインを導入する。
2. 初回解析を実施し、既存警告を棚卸しする。
3. 重大度基準と fail 条件をチームで定義する。

## 基本的な使い方

1. まずレポート取得モードで現状問題を把握する。
2. 重大な警告から優先対応する。
3. 誤検知は Filter 管理で抑制する。
4. 安定後に CI で fail 条件を段階的に厳格化する。

最小コマンド:
- Maven 例: `mvn spotbugs:check`
- Gradle 例: `./gradlew spotbugsMain`

## メリット

- 潜在不具合を早期に発見できる
- 品質事故の予防に効果が高い
- CI へ組み込んで継続運用しやすい
- 重大度ベースで改善計画を立てやすい

## デメリット

- 初回導入時に警告が大量発生しやすい
- 誤検知対応に調整コストがかかる
- 規約整形用途には別ツール併用が必要

## 他ツールとの比較

| ツール | 主な用途 | 特徴 |
|------|------|------|
| SpotBugs | Java バグ検出 | 不具合パターン検出に特化 |
| Checkstyle | Java 規約検証 | コーディング規約中心 |
| PMD | Java 静的解析 | 設計/複雑度観点を含む |
| SonarQube | 品質可視化 | 多言語統合とダッシュボードに強い |

## ベストプラクティス

### 1. 重大度で段階導入

- Critical/High 警告から対応する
- 一気に全警告対応しない

### 2. 誤検知を管理

- Filter で抑制し、理由を残す
- 抑制ルールを定期的に見直す

### 3. CI 基準を明確化

- fail 条件を明文化する
- 新規警告の持ち込みを防ぐ

## 公式ドキュメント

- 公式: https://spotbugs.github.io/
- GitHub: https://github.com/spotbugs/spotbugs
- Maven Plugin: https://spotbugs.github.io/spotbugs-maven-plugin/

## まとめ

1. **不具合検出** : SpotBugs は Java の潜在不具合検出に有効。
2. **段階導入** : 重大度優先の段階導入で運用負荷を抑えられる。
3. **継続運用** : 誤検知管理と CI 基準明確化が継続運用の鍵。
