# mypy

## 概要

mypy は Python の型チェックツールである。型注釈を活用して実行前に型不整合を検出し、リファクタ時の安全性と保守性を高められる。

## 料金

| 区分 | 内容 |
|------|------|
| mypy 本体 | 無料（OSS） |
| 補足 | CI 実行環境コストは別途 |

## 主な特徴

| 項目 | 内容 |
|------|------|
| 型安全性向上 | 実行前に型エラーを検出 |
| 段階導入可能 | ファイル単位で適用範囲を拡張可能 |
| Python 連携 | 型ヒント文化と親和性が高い |
| CI 連携 | 回帰防止の品質ゲートにしやすい |
| エコシステム | stubs/プラグインで拡張可能 |

## 主な機能

### 型検証機能

| 機能 | 説明 |
|------|------|
| 関数型検証 | 引数・戻り値の整合を確認 |
| クラス型検証 | 属性・継承・プロトコルを検証 |
| Optional 検証 | `None` 取り扱いの不備を検出 |
| 型推論 | 注釈不足箇所を補助的に推定 |

### 設定機能

| 機能 | 説明 |
|------|------|
| 設定ファイル | 厳格度や対象範囲を制御 |
| strict モード | 厳密チェックで品質向上 |
| ignore 制御 | 例外箇所を限定管理 |
| 依存型情報 | type stubs で外部ライブラリ対応 |

### 運用機能

| 機能 | 説明 |
|------|------|
| 増分適用 | 既存コードへ段階適用 |
| pre-commit 連携 | コミット前検証 |
| CI 実行 | PR で型破壊を検出 |
| 開発支援 | IDE 型補完品質向上に寄与 |

## インストールとセットアップ

公式URL:
- [mypy 公式](https://mypy-lang.org/)
- [mypy Docs](https://mypy.readthedocs.io/)

セットアップ手順:
1. 開発依存に mypy を追加する。
2. 設定ファイルで対象パスと厳格度を定義する。
3. 重要モジュールから型注釈を段階導入する。

## 基本的な使い方

1. まず対象ディレクトリを限定して実行する。
2. エラーを重大度順に整理し、型注釈を追加する。
3. `Any` の過剰利用を減らし、型情報を明確化する。
4. 安定後に strict ルールを段階的に強化する。

最小コマンド:
- 型検証: `mypy src/`

## メリット

- 実行前に型不整合を検出できる
- リファクタ時の安全性が向上する
- 大規模コードでの可読性が向上する
- CI 品質ゲートとして有効

## デメリット

- 導入初期に型付けコストがかかる
- 動的実装が多いコードでは調整が必要
- サードパーティ型情報不足時に対応が必要

## 他ツールとの比較

| ツール | 主な用途 | 特徴 |
|------|------|------|
| mypy | Python 型検証 | 広く採用される標準的ツール |
| pyright | Python 型検証 | 高速で IDE 連携が強い |
| Ruff | Python lint/format | 型検証は補助的 |
| pylint | Python 静的解析 | 型より規約・品質観点中心 |

## ベストプラクティス

### 1. 段階導入で進める

- 重要モジュールから先に適用する
- 全体 strict 化は段階的に行う

### 2. 例外を最小化

- `# type: ignore` は理由付きで管理する
- 定期的に ignore を削減する

### 3. 依存型情報を整備

- 必要な stubs を導入する
- 社内ライブラリは型注釈を同時整備する

## 公式ドキュメント

- 公式: https://mypy-lang.org/
- ドキュメント: https://mypy.readthedocs.io/
- GitHub: https://github.com/python/mypy

## まとめ

1. ** 型安全 ** : mypy は Python の型安全性向上に有効。
2. ** 段階導入 ** : 段階導入と strict 強化の順序が運用成功に直結する。
3. ** 継続整備 ** : 例外管理と型情報整備を継続することが重要。
