# k6

## æ¦‚è¦

k6ã¯ã€Grafana Labsè£½ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹è² è·ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã§ã™ã€‚JavaScript DSLã€CLIå®Ÿè¡Œã€ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ˆHTTPã€WebSocketï¼‰ã€ã‚·ãƒŠãƒªã‚ªãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆã€è² è·ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãƒ©ãƒ³ãƒ—ã‚¢ãƒƒãƒ—ã€ã‚¹ãƒ‘ã‚¤ã‚¯ï¼‰ã«ã‚ˆã‚Šã€Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆãƒ»è² è·ãƒ†ã‚¹ãƒˆã‚’å®Ÿç¾ã—ã¾ã™ã€‚é–‹ç™ºè€…ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ã€CI/CDçµ±åˆã€Grafana/Prometheusã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã§åºƒãæ¡ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

## ä¸»ãªæ©Ÿèƒ½

### 1. è² è·ãƒ†ã‚¹ãƒˆ
- **HTTP**: REST APIã€Webã‚µã‚¤ãƒˆ
- **WebSocket**: WebSocketæ¥ç¶š
- **gRPC**: gRPCã‚µãƒ¼ãƒ“ã‚¹
- **ãƒ–ãƒ©ã‚¦ã‚¶**: ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ–ãƒ©ã‚¦ã‚¶

### 2. ã‚·ãƒŠãƒªã‚ª
- **Virtual Users**: VUæ•°è¨­å®š
- **ãƒ©ãƒ³ãƒ—ã‚¢ãƒƒãƒ—**: å¾ã€…ã«è² è·å¢—åŠ 
- **ã‚¹ãƒ‘ã‚¤ã‚¯**: æ€¥æ¿€ãªè² è·
- **ã‚¹ãƒ†ãƒƒãƒ—**: æ®µéšçš„è² è·

### 3. ãƒ¡ãƒˆãƒªã‚¯ã‚¹
- **HTTP**: ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ ã€æˆåŠŸç‡
- **ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹**: Counterã€Gaugeã€Trend
- **Checks**: ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³
- **Thresholds**: åˆæ ¼åŸºæº–

### 4. çµ±åˆ
- **Grafana Cloud**: k6 Cloud
- **Prometheus**: Prometheusã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- **CI/CD**: GitHub Actionsã€GitLab CI

## åˆ©ç”¨æ–¹æ³•

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# macOS
brew install k6

# Linux
sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys C5AD17C747E3415A3642D57D77C6C491D6AC1D69
echo "deb https://dl.k6.io/deb stable main" | sudo tee /etc/apt/sources.list.d/k6.list
sudo apt-get update
sudo apt-get install k6

# Docker
docker pull grafana/k6
```

### åŸºæœ¬ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```javascript
// script.js
import http from 'k6/http';
import { check, sleep } from 'k6';

export let options = {
  vus: 10,           // 10 Virtual Users
  duration: '30s',   // 30ç§’é–“å®Ÿè¡Œ
};

export default function () {
  let response = http.get('https://test.k6.io');

  check(response, {
    'status is 200': (r) => r.status === 200,
    'response time < 500ms': (r) => r.timings.duration < 500,
  });

  sleep(1);
}
```

```bash
# å®Ÿè¡Œ
k6 run script.js
```

### ãƒ©ãƒ³ãƒ—ã‚¢ãƒƒãƒ—

```javascript
export let options = {
  stages: [
    { duration: '30s', target: 20 },   // 30ç§’ã§20 VUã¾ã§å¢—åŠ 
    { duration: '1m', target: 100 },   // 1åˆ†ã§100 VUã¾ã§å¢—åŠ 
    { duration: '30s', target: 0 },    // 30ç§’ã§0 VUã¾ã§æ¸›å°‘
  ],
};

export default function () {
  http.get('https://test.k6.io');
  sleep(1);
}
```

### POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

```javascript
import http from 'k6/http';

export default function () {
  let url = 'https://httpbin.test.k6.io/post';
  let payload = JSON.stringify({
    name: 'Alice',
    email: 'alice@example.com',
  });

  let params = {
    headers: {
      'Content-Type': 'application/json',
    },
  };

  let response = http.post(url, payload, params);
  check(response, {
    'status is 200': (r) => r.status === 200,
  });
}
```

### Checks ã¨ Thresholds

```javascript
import http from 'k6/http';
import { check } from 'k6';

export let options = {
  thresholds: {
    http_req_duration: ['p(95)<500'],   // 95%ile < 500ms
    http_req_failed: ['rate<0.01'],     // ã‚¨ãƒ©ãƒ¼ç‡ < 1%
    checks: ['rate>0.95'],              // CheckæˆåŠŸç‡ > 95%
  },
};

export default function () {
  let response = http.get('https://test.k6.io');

  check(response, {
    'status is 200': (r) => r.status === 200,
    'body contains text': (r) => r.body.includes('Collection'),
  });
}
```

### ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹

```javascript
import http from 'k6/http';
import { Counter, Gauge, Trend } from 'k6/metrics';

let myCounter = new Counter('my_counter');
let myGauge = new Gauge('my_gauge');
let myTrend = new Trend('my_trend');

export default function () {
  let response = http.get('https://test.k6.io');

  myCounter.add(1);
  myGauge.add(response.body.length);
  myTrend.add(response.timings.duration);
}
```

### ã‚·ãƒŠãƒªã‚ª

```javascript
export let options = {
  scenarios: {
    constant_load: {
      executor: 'constant-vus',
      vus: 10,
      duration: '30s',
    },
    ramping_load: {
      executor: 'ramping-vus',
      startVUs: 0,
      stages: [
        { duration: '10s', target: 50 },
        { duration: '20s', target: 100 },
      ],
    },
  },
};

export default function () {
  http.get('https://test.k6.io');
}
```

### CI/CDçµ±åˆï¼ˆGitHub Actionsï¼‰

```yaml
name: k6 Load Test

on: [push]

jobs:
  k6-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Run k6 test
        uses: grafana/k6-action@v0.3.0
        with:
          filename: script.js
          flags: --out json=results.json

      - name: Upload results
        uses: actions/upload-artifact@v3
        with:
          name: k6-results
          path: results.json
```

### Dockerå®Ÿè¡Œ

```bash
docker run -i grafana/k6 run - < script.js

# ãƒ•ã‚¡ã‚¤ãƒ«ãƒã‚¦ãƒ³ãƒˆ
docker run -i -v $(pwd):/scripts grafana/k6 run /scripts/script.js
```

## ã‚¨ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ãƒ»æ–™é‡‘

| ã‚¨ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ | ä¾¡æ ¼ | ç‰¹å¾´ |
|-------------|------|------|
| **k6 OSS** | ğŸŸ¢ ç„¡æ–™ | ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã€AGPLv3 License |
| **Grafana Cloud k6** | ğŸ’° $49/æœˆã€œ | ã‚¯ãƒ©ã‚¦ãƒ‰å®Ÿè¡Œã€åˆ†æ•£ãƒ†ã‚¹ãƒˆ |

## ãƒ¡ãƒªãƒƒãƒˆ

1. **ç„¡æ–™**: ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹
2. **é–‹ç™ºè€…ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼**: JavaScript DSL
3. **CLI**: ã‚·ãƒ³ãƒ—ãƒ«CLI
4. **CI/CDçµ±åˆ**: GitHub Actionsã€GitLab CI
5. **ãƒ¡ãƒˆãƒªã‚¯ã‚¹**: è©³ç´°ãƒ¡ãƒˆãƒªã‚¯ã‚¹

## ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ

1. **ãƒ–ãƒ©ã‚¦ã‚¶åˆ¶é™**: ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ–ãƒ©ã‚¦ã‚¶é™å®šçš„
2. **åˆ†æ•£å®Ÿè¡Œ**: OSSç‰ˆã¯å˜ä¸€ãƒã‚·ãƒ³
3. **GUI**: GUIéå¯¾å¿œ
4. **å­¦ç¿’æ›²ç·š**: JavaScriptå­¦ç¿’å¿…è¦

## å…¬å¼ãƒªãƒ³ã‚¯

- **å…¬å¼ã‚µã‚¤ãƒˆ**: [https://k6.io/](https://k6.io/)
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: [https://k6.io/docs/](https://k6.io/docs/)

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [è² è·ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ä¸€è¦§](../è² è·ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«/)
- [JMeter](./JMeter.md)
- [Gatling](./Gatling.md)

---

**ã‚«ãƒ†ã‚´ãƒª**: è² è·ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«
**å¯¾è±¡å·¥ç¨‹**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
**æœ€çµ‚æ›´æ–°**: 2025å¹´12æœˆ
**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0
