#!/usr/bin/env python3
"""
ãƒ„ãƒ¼ãƒ«ãƒªãƒ³ã‚¯æ›´æ–°ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
æ—§ã‚«ãƒ†ã‚´ãƒªãƒ‘ã‚¹ã‚’æ–°ã‚«ãƒ†ã‚´ãƒªãƒ‘ã‚¹ã«ç½®æ›
"""

import re
from pathlib import Path

# æ—§ã‚«ãƒ†ã‚´ãƒª â†’ æ–°ã‚«ãƒ†ã‚´ãƒªã®ãƒãƒƒãƒ”ãƒ³ã‚°
CATEGORY_MAPPING = {
    # é–‹ç™ºãƒ„ãƒ¼ãƒ«
    "é–‹ç™ºãƒ„ãƒ¼ãƒ«": "é–‹ç™ºãƒ„ãƒ¼ãƒ«",
    "é–‹ç™ºç’°å¢ƒãƒ„ãƒ¼ãƒ«": "é–‹ç™ºãƒ„ãƒ¼ãƒ«",
    "CLIãƒ„ãƒ¼ãƒ«": "é–‹ç™ºãƒ„ãƒ¼ãƒ«",
    "ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ©ãƒ„ãƒ¼ãƒ«": "é–‹ç™ºãƒ„ãƒ¼ãƒ«",
    "ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«": "é–‹ç™ºãƒ„ãƒ¼ãƒ«",
    "ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ãƒ„ãƒ¼ãƒ«": "é–‹ç™ºãƒ„ãƒ¼ãƒ«",

    # ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãƒ»CI/CD
    "ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãƒ„ãƒ¼ãƒ«": "ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãƒ»CI_CD",
    "CI_CDãƒ„ãƒ¼ãƒ«": "ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãƒ»CI_CD",
    "è‡ªå‹•åŒ–ãƒ„ãƒ¼ãƒ«": "ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãƒ»CI_CD",

    # ã‚³ãƒ³ãƒ†ãƒŠãƒ»ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    "ã‚³ãƒ³ãƒ†ãƒŠãƒ„ãƒ¼ãƒ«": "ã‚³ãƒ³ãƒ†ãƒŠãƒ»ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³",
    "ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«": "ã‚³ãƒ³ãƒ†ãƒŠãƒ»ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³",
    "ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ„ãƒ¼ãƒ«": "ã‚³ãƒ³ãƒ†ãƒŠãƒ»ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³",
    "ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥ãƒ„ãƒ¼ãƒ«": "ã‚³ãƒ³ãƒ†ãƒŠãƒ»ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³",

    # IaCãƒ»ã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç†
    "IaCãƒ„ãƒ¼ãƒ«": "IaCãƒ»ã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç†",
    "IaCã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ„ãƒ¼ãƒ«": "IaCãƒ»ã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç†",
    "ã‚¤ãƒ³ãƒ•ãƒ©è¨­è¨ˆãƒ„ãƒ¼ãƒ«": "IaCãƒ»ã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç†",
    "æ§‹æˆç®¡ç†ãƒ„ãƒ¼ãƒ«": "IaCãƒ»ã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç†",
    "ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†ãƒ„ãƒ¼ãƒ«": "IaCãƒ»ã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç†",
    "ãƒãƒªã‚·ãƒ¼ç®¡ç†ãƒ„ãƒ¼ãƒ«": "IaCãƒ»ã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç†",

    # ãƒ†ã‚¹ãƒˆ
    "ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«": "ãƒ†ã‚¹ãƒˆ",
    "ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãƒ„ãƒ¼ãƒ«": "ãƒ†ã‚¹ãƒˆ",
    "ãƒ†ã‚¹ãƒˆç®¡ç†ãƒ„ãƒ¼ãƒ«": "ãƒ†ã‚¹ãƒˆ",
    "E2Eãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«": "ãƒ†ã‚¹ãƒˆ",
    "APIãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«": "ãƒ†ã‚¹ãƒˆ",
    "è² è·ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«": "ãƒ†ã‚¹ãƒˆ",
    "ã‚¤ãƒ³ãƒ•ãƒ©ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«": "ãƒ†ã‚¹ãƒˆ",

    # å“è³ªãƒ»é™çš„è§£æ
    "é™çš„è§£æãƒ„ãƒ¼ãƒ«": "å“è³ªãƒ»é™çš„è§£æ",
    "Lintãƒ„ãƒ¼ãƒ«": "å“è³ªãƒ»é™çš„è§£æ",
    "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ãƒ„ãƒ¼ãƒ«": "å“è³ªãƒ»é™çš„è§£æ",

    # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
    "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ„ãƒ¼ãƒ«": "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹",
    "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆãƒ„ãƒ¼ãƒ«": "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹",
    "NoSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ„ãƒ¼ãƒ«": "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹",
    "ã‚¯ã‚¨ãƒªãƒ„ãƒ¼ãƒ«": "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹",
    "ãƒ‡ãƒ¼ã‚¿ç§»è¡Œãƒ„ãƒ¼ãƒ«": "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹",
    "ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«": "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹",

    # APIãƒ»çµ±åˆ
    "APIãƒ„ãƒ¼ãƒ«": "APIãƒ»çµ±åˆ",
    "APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ„ãƒ¼ãƒ«": "APIãƒ»çµ±åˆ",
    "ãƒ¢ãƒƒã‚¯ãƒ„ãƒ¼ãƒ«": "APIãƒ»çµ±åˆ",
    "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ãƒ„ãƒ¼ãƒ«": "APIãƒ»çµ±åˆ",

    # Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
    "Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãƒ„ãƒ¼ãƒ«": "Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³",
    "ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãƒ„ãƒ¼ãƒ«": "Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³",
    "ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãƒ„ãƒ¼ãƒ«": "Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³",
    "Webã‚µãƒ¼ãƒãƒ¼ãƒ„ãƒ¼ãƒ«": "Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³",
    "ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒãƒ¼ãƒ„ãƒ¼ãƒ«": "Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³",
    "ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ãƒ„ãƒ¼ãƒ«": "Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³",

    # ç›£è¦–ãƒ»ãƒ­ã‚®ãƒ³ã‚°
    "ç›£è¦–ãƒ„ãƒ¼ãƒ«": "ç›£è¦–ãƒ»ãƒ­ã‚®ãƒ³ã‚°",
    "ãƒ­ã‚°åé›†ãƒ„ãƒ¼ãƒ«": "ç›£è¦–ãƒ»ãƒ­ã‚®ãƒ³ã‚°",
    "ãƒ­ã‚°å‡¦ç†ãƒ„ãƒ¼ãƒ«": "ç›£è¦–ãƒ»ãƒ­ã‚®ãƒ³ã‚°",
    "åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ãƒ„ãƒ¼ãƒ«": "ç›£è¦–ãƒ»ãƒ­ã‚®ãƒ³ã‚°",
    "å¯è¦–åŒ–ãƒ„ãƒ¼ãƒ«": "ç›£è¦–ãƒ»ãƒ­ã‚®ãƒ³ã‚°",

    # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
    "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ„ãƒ¼ãƒ«": "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£",
    "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆãƒ„ãƒ¼ãƒ«": "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£",

    # è¨­è¨ˆãƒ»ãƒ¢ãƒ‡ãƒªãƒ³ã‚°
    "è¨­è¨ˆãƒ„ãƒ¼ãƒ«": "è¨­è¨ˆãƒ»ãƒ¢ãƒ‡ãƒªãƒ³ã‚°",
    "UMLãƒ„ãƒ¼ãƒ«": "è¨­è¨ˆãƒ»ãƒ¢ãƒ‡ãƒªãƒ³ã‚°",
    "UI_UXãƒ„ãƒ¼ãƒ«": "è¨­è¨ˆãƒ»ãƒ¢ãƒ‡ãƒªãƒ³ã‚°",
    "ä½œå›³ãƒ„ãƒ¼ãƒ«": "è¨­è¨ˆãƒ»ãƒ¢ãƒ‡ãƒªãƒ³ã‚°",
    "ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ„ãƒ¼ãƒ«": "è¨­è¨ˆãƒ»ãƒ¢ãƒ‡ãƒªãƒ³ã‚°",
    "ãƒ—ãƒ­ã‚»ã‚¹ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ãƒ„ãƒ¼ãƒ«": "è¨­è¨ˆãƒ»ãƒ¢ãƒ‡ãƒªãƒ³ã‚°",

    # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
    "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ãƒ„ãƒ¼ãƒ«": "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ",
    "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç®¡ç†ãƒ„ãƒ¼ãƒ«": "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ",
    "ãƒŠãƒ¬ãƒƒã‚¸ç®¡ç†ãƒ„ãƒ¼ãƒ«": "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ",
    "ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«": "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ",
    "è¦ä»¶ç®¡ç†ãƒ„ãƒ¼ãƒ«": "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ",
    "ã‚¢ã‚¤ãƒ‡ã‚¢æ•´ç†ãƒ„ãƒ¼ãƒ«": "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ",

    # å¸³ç¥¨ãƒ»ãƒ‡ãƒ¼ã‚¿å‡¦ç†
    "å¸³ç¥¨ãƒ„ãƒ¼ãƒ«": "å¸³ç¥¨ãƒ»ãƒ‡ãƒ¼ã‚¿å‡¦ç†",
    "è¡¨è¨ˆç®—ãƒ„ãƒ¼ãƒ«": "å¸³ç¥¨ãƒ»ãƒ‡ãƒ¼ã‚¿å‡¦ç†",
    "ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ„ãƒ¼ãƒ«": "å¸³ç¥¨ãƒ»ãƒ‡ãƒ¼ã‚¿å‡¦ç†",
    "ãƒãƒƒãƒå‡¦ç†ãƒ„ãƒ¼ãƒ«": "å¸³ç¥¨ãƒ»ãƒ‡ãƒ¼ã‚¿å‡¦ç†",

    # ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£
    "ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†ãƒ„ãƒ¼ãƒ«": "ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£",
    "ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ„ãƒ¼ãƒ«": "ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£",
    "ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ„ãƒ¼ãƒ«": "ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£",
    "æ¤œç´¢ãƒ„ãƒ¼ãƒ«": "ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£",

    # é‹ç”¨ãƒ»ITSM
    "ITSMãƒ„ãƒ¼ãƒ«": "é‹ç”¨ãƒ»ITSM",
    "ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆç®¡ç†ãƒ„ãƒ¼ãƒ«": "é‹ç”¨ãƒ»ITSM",
    "ãƒ¬ãƒãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ„ãƒ¼ãƒ«": "é‹ç”¨ãƒ»ITSM",

    # ãã®ã¾ã¾ç¶­æŒ
    "æ¨™æº–ãƒ»ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³": "æ¨™æº–ãƒ»ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³",
}

def update_markdown_links(file_path: Path, dry_run: bool = False):
    """
    Markdownãƒ•ã‚¡ã‚¤ãƒ«å†…ã®ãƒªãƒ³ã‚¯ã‚’æ›´æ–°

    Args:
        file_path: æ›´æ–°å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
        dry_run: Trueã®å ´åˆã€å®Ÿéš›ã®æ›´æ–°ã¯è¡Œã‚ãšãƒ­ã‚°ã®ã¿å‡ºåŠ›
    """
    with open(file_path, 'r', encoding='utf-8') as f:
        content = f.read()

    original_content = content
    changes = 0

    # ãƒªãƒ³ã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³: [text](./ãƒ„ãƒ¼ãƒ«/æ—§ã‚«ãƒ†ã‚´ãƒª/ãƒ•ã‚¡ã‚¤ãƒ«.md)
    for old_cat, new_cat in CATEGORY_MAPPING.items():
        if old_cat == new_cat:
            continue

        # ãƒ‘ã‚¿ãƒ¼ãƒ³1: ./ãƒ„ãƒ¼ãƒ«/æ—§ã‚«ãƒ†ã‚´ãƒª/
        pattern1 = f"./ãƒ„ãƒ¼ãƒ«/{old_cat}/"
        replacement1 = f"./ãƒ„ãƒ¼ãƒ«/{new_cat}/"
        if pattern1 in content:
            count = content.count(pattern1)
            content = content.replace(pattern1, replacement1)
            changes += count
            print(f"  {old_cat} â†’ {new_cat}: {count}ä»¶")

        # ãƒ‘ã‚¿ãƒ¼ãƒ³2: (ãƒ„ãƒ¼ãƒ«/æ—§ã‚«ãƒ†ã‚´ãƒª/
        pattern2 = f"ãƒ„ãƒ¼ãƒ«/{old_cat}/"
        replacement2 = f"ãƒ„ãƒ¼ãƒ«/{new_cat}/"
        if pattern2 in content and pattern1 not in f"({pattern2}":
            count = content.count(pattern2) - content.count(f"./{pattern2}")
            if count > 0:
                content = content.replace(pattern2, replacement2)
                changes += count
                print(f"  {old_cat} â†’ {new_cat} (ç›¸å¯¾): {count}ä»¶")

    if changes > 0:
        if dry_run:
            print(f"  [DRY-RUN] åˆè¨ˆ {changes}ä»¶ã®å¤‰æ›´")
        else:
            with open(file_path, 'w', encoding='utf-8') as f:
                f.write(content)
            print(f"  âœ“ åˆè¨ˆ {changes}ä»¶ã‚’æ›´æ–°")
        return changes
    else:
        print(f"  å¤‰æ›´ãªã—")
        return 0

def main():
    """ãƒ¡ã‚¤ãƒ³å‡¦ç†"""
    print("=" * 60)
    print("ãƒ„ãƒ¼ãƒ«ãƒªãƒ³ã‚¯æ›´æ–°ã‚¹ã‚¯ãƒªãƒ—ãƒˆ")
    print("=" * 60)
    print()

    # æ›´æ–°å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
    target_files = [
        Path("/src/docs/ãƒ„ãƒ¼ãƒ«ç´¢å¼•.md"),
        Path("/src/docs/ãƒ„ãƒ¼ãƒ«/ãƒ„ãƒ¼ãƒ«ä¸€è¦§.md"),
    ]

    # å·¥ç¨‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚è¿½åŠ 
    docs_dir = Path("/src/docs")
    for md_file in docs_dir.glob("dev_process_*.md"):
        target_files.append(md_file)

    total_changes = 0

    for file_path in target_files:
        if not file_path.exists():
            print(f"âš ï¸  ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¾ã›ã‚“: {file_path}")
            continue

        print(f"\nğŸ“„ {file_path.name}")
        changes = update_markdown_links(file_path, dry_run=False)
        total_changes += changes

    print("\n" + "=" * 60)
    print(f"âœ… æ›´æ–°å®Œäº†: åˆè¨ˆ {total_changes}ä»¶ã®ãƒªãƒ³ã‚¯ã‚’æ›´æ–°")
    print("=" * 60)

if __name__ == "__main__":
    main()
